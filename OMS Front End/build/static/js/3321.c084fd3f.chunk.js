"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3321],{91868:(e,t,n)=>{n.d(t,{qz:()=>i,r:()=>o});var l=n(69885),a=n(15335),s=n(79663);const i={name:"Document Form",initialState:{name:"",documentTypeId:"",supplierId:"",customerId:"",attachment:"",base64File:"",storagePath:""},formFields:[{id:"documentTypeId",lable:"Document Type ",Field_Name:"Document Type",fieldType:a.Q.SELECT,fieldType:a.Q.EDITABLEDROPDOWN,dataField:"documentTypeId",fieldSetting:{placeholder:"Select Document Type",isEnableOnChange:!0,options:[]},validation:[{type:"require"}],style:{containerCss:"col-xxl-6 col-xl-12 col-md-6 col-12 mb-input"}},{id:"name",lable:"Document Name ",Field_Name:"Document Name",fieldType:a.Q.INPUT,dataField:"name",fieldSetting:{placeholder:"Enter Document Name",allowSpace:!0,maxLength:50,isDisable:!0},validation:[{type:"require"}],style:{containerCss:"col-xxl-6 col-xl-12 col-md-6 col-12 mb-input"}},{id:"attachment",lable:"Attachment ",Field_Name:"Attachment",fieldType:a.Q.FILE,dataField:"attachment",fieldSetting:{placeholder:"Upload Attachment",allowSpace:!0,isButtonVisible:!1,isCustomButtonVisible:!0,acceptedFiles:".pdf , .docx "},validation:[{type:"require"}],style:{containerCss:"col-xxl-12 col-xl-12 col-md-12 col-12 col-12 mb-input mb-0 custom-file-upload-section"}}]},o=(s.f.ACTION,[{type:"pdf",icon:l.m.PdfIcon},{type:"doc",icon:l.m.DocIcon},{type:"docx",icon:l.m.DocIcon},{type:"xlsx",icon:l.m.XlsIcon},{type:"xls",icon:l.m.XlsIcon},{type:"ppt",icon:l.m.PptIcon},{type:"zip",icon:l.m.ZipIcon},{type:"csv",icon:l.m.CsvIcon}])},53321:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var l=n(27565),a=n(69885),s=n(91868),i=n(17295),o=n(67724),d=n(15269),c=n(93906),u=n(60497),r=n(18637);const m={name:"Document Form",initialState:{attachment:""},formFields:[{id:"attachment",lable:"Attachment ",Field_Name:"Attachment",fieldType:n(15335).Q.FILE,dataField:"attachment",fieldSetting:{placeholder:"Upload Attachment",allowSpace:!0,isButtonVisible:!1,isCustomButtonVisible:!0,acceptedFiles:".pdf , .docx ",isFileNameCleared:!0,isMultiple:!0},validation:[{type:"require"}],style:{containerCss:"col-xxl-12 col-xl-12 col-md-12 col-12 col-12 mb-input mb-0 custom-file-upload-section"}}]};n(31785);var p=n(35263),S=n(69377),I=n(98161),A=n(28734),C=n(65748),T=n(17690),D=n(89840),h=n(721),E=n(80889),f=n(5022),g=n(2604);const N={[h.V.CUSTOMERUPDATE]:["TaxId","Name"]},y=()=>{const{success:e,warning:t}=(0,E.A)(),[n,a]=(0,l.useState)(!1),[s]=(0,f.TX)(),[i]=(0,g.ip)(),o=(e,t)=>{const{newValueNormalized:n,oldValueNormalized:l}=d(e,t,!0);return JSON.stringify(n)===JSON.stringify(l)},d=(e,t,n)=>{const l=e=>Array.isArray(e)?e.map((e=>l(e))):e&&"object"===typeof e?Object.fromEntries(Object.entries(e).map((e=>{let[t,a]=e;return[t.toLowerCase(),"object"===typeof a?l(a):n?String(a):a]}))):e;return{newValueNormalized:e?l(e):e,oldValueNormalized:t?l(t):t,originalValues:{newValue:e,oldValue:t}}},c=(e,t)=>Object.keys(t).find((t=>t.toLowerCase()===e));return{ValidateRequestByApprovalRules:async n=>{a(!0);const l=(0,D.bQ)("approvalRules")||[];if(!l.length)return a(!1),n;const{eventName:u="",newValue:r={},oldValue:m={}}=n,p=l.filter((e=>e.eventName===u));if(!p.length)return a(!1),n;const{newValueNormalized:S,oldValueNormalized:I,originalValues:A}=d(r,m);if(n.isFunctionalObjMatch){if(o(r,m))return a(!1),n}let h=!1,E=[],f="";for(const e of p){const{fieldName:n,isFunctional:l}=e;if(!l){if((N[u]||[]).includes(n)){const e=n.toLowerCase(),l=c(e,A.newValue),s=S[e];if(s!==I[e]){if((await i({fieldName:l,fieldValue:s})).data.exist)return a(!1),t(T.n.FieldsApprovalExists.replace("{0}",n))}}}}for(const e of p){const{fieldName:t,moduleId:n,functionalityId:l,tableId:a,functionalitiesFieldId:i,functionalityEventId:o,isFunctional:d}=e;if(d){const e={moduleId:n,functionalityId:l,tableId:a,functionalitiesFieldId:i,functionalityEventId:o,oldValue:A.oldValue?JSON.stringify(A.oldValue):null,newValue:JSON.stringify(A.newValue)};try{await s(e),h=!0,E.push(u)}catch(g){console.error("Error adding approval request:",g)}}else if(!d)if(t){const e=t.toLowerCase(),d=c(e,A.newValue),r=S[e],m=I[e];if(r!==m){const e={moduleId:n,functionalityId:l,tableId:a,functionalitiesFieldId:i,functionalityEventId:o,oldValue:JSON.stringify(I),newValue:JSON.stringify(S)};try{(N[u]||[]).includes(t);h=!0,await s(e),A.newValue[d]=m,E.push(t)}catch(g){C.A.warning(g)}}}else C.A.warning(T.K.FieldNameNotFound)}if(h)if(n.isCustomeMessage&&E.length>0){f=1===E.length?E[0]:E.slice(0,-1).join(", ")+" and "+E.slice(-1)}else e(T.n.ApprovalSuccess);return a(!1),{...n,newValue:A.newValue,oldValue:A.oldValue,isallSuccessful:h,approvalMessage:f}},getEventName:(e,t,n)=>{switch(n){case"AddEditAddressCustomer":return e===A.RX.BILLING.toString()?t?h.V.UPDATECUSTOMERBILLINGADDRESS:h.V.ADDCUSTOMERBILLINGADDRESS:e===A.RX.SHIPPING.toString()?t?h.V.UPDATECUSTOMERSHIPPINGADDRESS:h.V.ADDCUSTOMERSHIPPINGADDRESS:void 0;case"AddEditContactCustomer":return e.toString()===A.Pm.INVOICESUBMISSION.toString()?t?h.V.UPDATECUSTOMERINVOICESUBMISSIONCONTACT:h.V.ADDCUSTOMERINVOICESUBMISSIONCONTACT:e.toString()===A.Pm.INVOICEFOLLOWUP.toString()?t?h.V.UPDATECUSTOMERINVOICEFOLLOWUPCONTACT:h.V.ADDCUSTOMERINVOICEFOLLOWUPCONTACT:void 0;default:return null}},compareObj:o,isApprovelLoading:n}};var x=n(55711),U=n(27929);const O=e=>{switch(e){case"pdf":return a.m.PdfIcon;case"doc":case"docx":return a.m.DocIcon;case"xls":case"xlsx":return a.m.XlsIcon;case"ppt":case"pptx":return a.m.PptIcon;case"csv":return a.m.CsvIcon;case"zip":case"rar":return a.m.ZipIcon;default:return a.m.defaultFileIcon}},P=e=>{let{isSupplier:t,keyId:n,handleMulDocToggleModal:a,addDocuments:s,documentTypes:i,isEditablePage:o,customerStatusId:d}=e;const c=(0,l.useRef)(),[D,h]=(0,l.useState)([]),[E,f]=(0,l.useState)([]),[g,N]=(0,l.useState)(null),[P,b]=(0,l.useState)([]),{ValidateRequestByApprovalRules:R,isApprovelLoading:M}=y(),[v,{isLoading:j,isSuccess:F,data:V}]=s(),[L,w]=(0,l.useState)(""),B=e=>{const t=[...P];t.includes(e)?t.splice(t.indexOf(e),1):t.push(e),b(t)};(0,l.useEffect)((()=>{if(F&&V){if(V.errorMessage.includes("exists"))return void C.A.warning(V.errorMessage);C.A.success(V.errorMessage),a()}}),[F,V]);const k=(e,t,n)=>{const{id:l,type:a}=(e=>e&&"object"===typeof e?(console.log("Original Document Type Data:",e),{id:e.value||e.id||0,type:e.text||""}):{id:e||0,type:""})(e.documentTypeId,e.documentType);return{...e,[t?"supplierId":"customerId"]:n,documentTypeId:l,documentType:e.documentType,createdAt:e.createdAt||new Date}},G={DDL_FILE:e=>{const t=e.split(", ").map((e=>({name:e,attachment:e,extension:(e=>{const t=e.split(".");return t.length>1?t.pop().toLowerCase():""})(e),documentTypeId:null})));f((e=>[...e,...t]))}};return(0,U.jsxs)("div",{className:"row",children:[(0,U.jsx)(r.A,{config:m,ref:c,onActionChange:G,onFormDataChange:e=>{h((t=>[...t,...null===e||void 0===e?void 0:e.attachment]))}}),(0,U.jsxs)("table",{className:"custom-table mt-4",children:[(0,U.jsx)("thead",{children:(0,U.jsxs)("tr",{children:[(0,U.jsx)("th",{}),(0,U.jsx)("th",{children:"Name"}),(0,U.jsx)("th",{children:"Type"}),(0,U.jsx)("th",{children:"Action"})]})}),(0,U.jsx)("tbody",{children:0===E.length?(0,U.jsx)("tr",{children:(0,U.jsx)("td",{colSpan:"3",children:(0,U.jsx)(S.A,{})})}):E.map(((e,t)=>(0,U.jsxs)("tr",{children:[(0,U.jsx)("td",{children:(0,U.jsx)("img",{src:O(e.extension),alt:e.name,className:"file-icon"})}),(0,U.jsxs)("td",{children:[" ",(0,U.jsx)(x.default,{type:"text",value:e.name,onChange:e=>((e,t)=>{f((n=>n.map(((n,l)=>l===e?{...n,name:t}:n))))})(t,e.target.value)})]}),(0,U.jsx)("td",{children:P.includes(t)?(0,U.jsxs)("div",{className:"d-flex align-items-center",children:[(0,U.jsx)(x.default,{type:"text",value:e.documentType,onChange:e=>((e,t)=>{f((n=>n.map(((n,l)=>l===e?{...n,documentType:t}:n))))})(t,e.target.value)}),(0,U.jsx)("button",{onClick:()=>B(t),style:{background:"none",border:"none",cursor:"pointer",padding:"10px"},children:(0,U.jsx)("img",{src:"/static/media/cancel.0c96fd8d030cbf121ac0.png",style:{width:"20px",height:"20px"}})})]}):(0,U.jsxs)("div",{className:"d-flex align-items-center",children:[(0,U.jsx)(I.Ay,{value:i.find((t=>t.value===e.documentTypeId))||null,onChange:e=>{((e,t)=>{const n=t?t.value:"";f((t=>t.map(((t,l)=>l===e?{...t,documentTypeId:n}:t)))),N(e)})(t,e)},options:i,className:"react-select",classNamePrefix:"react-select",menuPortalTarget:document.body,menuPosition:"absolute",isOpen:g===t,onMenuOpen:()=>N(t),onMenuClose:()=>N(null),styles:{menuPortal:e=>({...e,zIndex:9999})}}),(0,U.jsx)("button",{onClick:()=>B(t),style:{background:"none",border:"none",cursor:"pointer",padding:"10px"},children:(0,U.jsx)("img",{src:"/static/media/pencil.3c8bbd8b96aa6f946db1.png",style:{width:"20px",height:"20px"}})})]})}),(0,U.jsx)("td",{children:(0,U.jsxs)("button",{onClick:()=>(e=>{f((t=>t.filter(((t,n)=>n!==e))))})(t),className:"delete-button",children:[" ",(0,U.jsx)(p.A,{icon:"mingcute:delete-2-line",className:"delete-icon-model"})]})})]},t)))})]}),(0,U.jsxs)("div",{className:"d-flex align-item-end justify-content-end mt-3",children:[(0,U.jsx)(u.A,{buttonTypeClassName:"theme-button",isLoading:M||j,buttonText:"Save",onClick:async()=>{const e=E.map(((e,l)=>{const a=D.find(((e,t)=>t===l));return{...e,base64File:a?a.base64Data:null,...k(e,t,n)}}));if(e.every((e=>e.name&&e.base64File&&null!==e.documentTypeId))){const l={storagePath:t?A.Dh.SUPPLIER:A.Dh.CUSTOMER,[t?"supplierId":"customerId"]:n,documentInfoList:e};v(l)}else C.A.warning(T.K.DocumentDetailMissing)}}),(0,U.jsx)(u.A,{buttonTypeClassName:"dark-btn ml-5",buttonText:"Cancel",onClick:a})]})]})},b=l.lazy((()=>n.e(149).then(n.bind(n,30149)))),R=l.lazy((()=>Promise.all([n.e(7204),n.e(6282)]).then(n.bind(n,66282)))),M=e=>{let{keyId:t,isSupplier:n,addDocuments:u,downloadDocument:r,deleteDocumentsById:m,isArchive:p,getDocumentsById:S,isEditablePage:I,SecurityKey:A,customerStatusId:C}=e;const T=(0,l.useRef)(),[D,h]=(0,l.useState)(!1),[E,f]=(0,l.useState)([]),[g,N]=(0,l.useState)(!1),[y,x]=(0,l.useState)(!0),[O,{isSuccess:M,data:v}]=(0,c.Bl)();(0,l.useEffect)((()=>{O()}),[]),(0,l.useEffect)((()=>{if(I&&A){const e=(0,d.T)(A.ADD);e&&(!0===e.hasAccess?x(!0):x(!1))}}),[I,A]),(0,l.useEffect)((()=>{if(M&&v){const e=n?"isForSuppliers":"isForCustomers",t=v.filter((t=>t[e])).map((e=>({value:e.documentTypeId,label:e.type})));s.qz.formFields.find((e=>"documentTypeId"===e.dataField)).fieldSetting.options=t,f(t)}}),[M,v]);const j=()=>{h(!D)},F=()=>{N(!g),T.current&&T.current.callChildFunction()};return(0,U.jsxs)(l.Fragment,{children:[(0,U.jsx)("div",{className:"document-section",children:(0,U.jsx)(i.default,{cardTitle:p?null:"Attachments",titleButtonClick:p?null:j,textWithIcon:!0,iconImg:p?null:a.m.PlusIcon,buttonClassName:p?null:"theme-button",rightButton:p?null:y||!1,buttonText:p?null:"Add Document",multipleButton:p?null:y||!1,rightButtonArray:p?null:[{buttonTypeClassName:"theme-button",onClick:F,buttonText:"Add Multiple Document",textWithIcon:!0,imagePath:a.m.PlusIcon}],children:(0,U.jsx)("div",{className:"right-side-sec-padding-0",children:(0,U.jsx)(R,{childRef:T,isEditablePage:I,SecurityKey:A,keyId:t,isArchive:p,isSupplier:n,showModal:D,downloadDocument:r,deleteDocumentsById:m,getDocumentsById:S,setShowModal:h})})})}),(0,U.jsx)(o.A,{showModal:D,handleToggleModal:j,modalTitle:"Add Document",modelSizeClass:"w-50s",children:(0,U.jsx)(b,{isSupplier:n,keyId:t,showModal:D,addDocuments:u,handleToggleModal:j,onSuccess:()=>{h(!D),T.current&&T.current.callChildFunction()},isEditablePage:I,customerStatusId:C})}),(0,U.jsx)(o.A,{showModal:g,handleToggleModal:F,modalTitle:"Add Multiple Document",modelSizeClass:"w-50s",children:(0,U.jsx)(P,{addDocuments:u,isSupplier:n,keyId:t,documentTypes:E,handleMulDocToggleModal:F,isEditablePage:I,customerStatusId:C})})]})}},67724:(e,t,n)=>{n.d(t,{A:()=>s});n(27565);var l=n(85097),a=n(27929);const s=e=>{let{isApprovalValidate:t,showModal:n,handleToggleModal:s,children:i,...o}=e;return(0,a.jsxs)(l.A,{className:`center-model-popup ${o.modelSizeClass}`,show:n,onHide:s,keyboard:!t,backdrop:!t||"static",children:[(0,a.jsx)(l.A.Header,{closeButton:!t,children:(0,a.jsx)("div",{className:"model-title",children:o.modalTitle})}),(0,a.jsx)(l.A.Body,{children:i})]})}},721:(e,t,n)=>{n.d(t,{V:()=>l});const l={CUSTOMERBASICINFOUPDATE:"Customer Basic info update",CUSTOMERADDADDRESS:"Customer Add Address",CUSTOMERUPDATEADDRESS:"Customer Update Address",CUSTOMERADDCONTACT:"Customer Add Contact",CUSTOMERUPDATECONTACT:"Customer Update Contact",CUSTOMERADDUPDATEFINANCIALSETTING:"Customer Update Financial Setting",SUPPLIERBASICINFOUPDATE:"Supplier Basic info update",SUPPLIERADDADDRESS:"Supplier Add Address",SUPPLIERUPDATEADDRESS:"Supplier Update Address",SUPPLIERADDCONTACT:"Supplier Add Contact",SUPPLIERUPDATECONTACT:"Supplier Update Contact",SUPPLIERADDUPDATEFINANCIALSETTING:"Supplier Add/Update Financial Setting",ADDCUSTOMER:"Add Customer",UPDATESUPPLIER:"Update Supplier",ADDSUPPLIER:"Add Supplier",ADDADDRESS:"Add Address",ADDBILLINGADDRESS:"Add Billing Address",CUSTOMERUPDATE:"Customer Update",ADDCUSTOMERBILLINGADDRESS:"Add Customer Billing Address",UPDATECUSTOMERBILLINGADDRESS:"Update Customer Billing Address",ADDCUSTOMERSHIPPINGADDRESS:"Add Customer Shipping Address",UPDATECUSTOMERSHIPPINGADDRESS:"Update Customer Shipping Address",ADDCUSTOMERINVOICEFOLLOWUPCONTACT:"Add Customer Invoice Follow Up Contact",UPDATECUSTOMERINVOICEFOLLOWUPCONTACT:"Update Customer Invoice Follow Up Contact",ADDCUSTOMERINVOICESUBMISSIONCONTACT:"Add Customer Invoice Submission Contact",UPDATECUSTOMERINVOICESUBMISSIONCONTACT:"Update Customer Invoice Submission Contact",ADDCUSTOMERFINANCIALSETTING:"Add Customer Financial Setting",UPDATECUSTOMERFINANCIALSETTING:"Update Customer Financial Setting",UPDATECUSTOMERSHIPPINGSETTING:"Update Customer Shipping Setting",UPLOADCUSTOMERDOCUMENT:"Upload Customer Document"}},31785:()=>{}}]);
//# sourceMappingURL=3321.c084fd3f.chunk.js.map