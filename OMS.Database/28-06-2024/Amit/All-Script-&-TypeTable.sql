
/****** Object:  StoredProcedure [dbo].[ValidateSupplierData]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[ValidateSupplierData]
GO
/****** Object:  StoredProcedure [dbo].[ValidateCustomerData]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[ValidateCustomerData]
GO
/****** Object:  StoredProcedure [dbo].[UpdateUserPassword]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateUserPassword]
GO
/****** Object:  StoredProcedure [dbo].[UpdateUser]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateUser]
GO
/****** Object:  StoredProcedure [dbo].[UpdateSupplierStatus]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateSupplierStatus]
GO
/****** Object:  StoredProcedure [dbo].[UpdateSupplierNotes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateSupplierNotes]
GO
/****** Object:  StoredProcedure [dbo].[UpdateSupplierInActiveStatus]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateSupplierInActiveStatus]
GO
/****** Object:  StoredProcedure [dbo].[UpdateSupplierApproveStatus]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateSupplierApproveStatus]
GO
/****** Object:  StoredProcedure [dbo].[UpdateShppingDeliveryCarriers]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateShppingDeliveryCarriers]
GO
/****** Object:  StoredProcedure [dbo].[UpdateRoles]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateRoles]
GO
/****** Object:  StoredProcedure [dbo].[UpdateDeliveryMethods]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateDeliveryMethods]
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomerStatus]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateCustomerStatus]
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomersBasicInformation]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateCustomersBasicInformation]
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomerNotes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateCustomerNotes]
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomerInActiveStatus]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateCustomerInActiveStatus]
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomerApproveStatus]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateCustomerApproveStatus]
GO
/****** Object:  StoredProcedure [dbo].[UpdateContactPhone]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateContactPhone]
GO
/****** Object:  StoredProcedure [dbo].[UpdateContactEmail]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateContactEmail]
GO
/****** Object:  StoredProcedure [dbo].[UpdateAddressForSupplier]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateAddressForSupplier]
GO
/****** Object:  StoredProcedure [dbo].[UpdateAddressForCustomer]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateAddressForCustomer]
GO
/****** Object:  StoredProcedure [dbo].[UpdateAddAddress]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[UpdateAddAddress]
GO
/****** Object:  StoredProcedure [dbo].[test]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[test]
GO
/****** Object:  StoredProcedure [dbo].[GetUsers]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetUsers]
GO
/****** Object:  StoredProcedure [dbo].[GetUserCheckListByEventId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetUserCheckListByEventId]
GO
/****** Object:  StoredProcedure [dbo].[GetUserByUserName]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetUserByUserName]
GO
/****** Object:  StoredProcedure [dbo].[GetUserByUserId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetUserByUserId]
GO
/****** Object:  StoredProcedure [dbo].[GetUnAssignedUserByRoleId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetUnAssignedUserByRoleId]
GO
/****** Object:  StoredProcedure [dbo].[GetSuppliers]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetSuppliers]
GO
/****** Object:  StoredProcedure [dbo].[GetSupplierNotesBySupplierId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetSupplierNotesBySupplierId]
GO
/****** Object:  StoredProcedure [dbo].[GetSupplierDocuementById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetSupplierDocuementById]
GO
/****** Object:  StoredProcedure [dbo].[GetSupplierBasicInformationById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetSupplierBasicInformationById]
GO
/****** Object:  StoredProcedure [dbo].[GetSupplierAuditHistoryBySupplierId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetSupplierAuditHistoryBySupplierId]
GO
/****** Object:  StoredProcedure [dbo].[GetShppingDeliveryCarriersByCustomerId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetShppingDeliveryCarriersByCustomerId]
GO
/****** Object:  StoredProcedure [dbo].[GetShppingDeliveryCarrierAndDeliveryMethodsById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetShppingDeliveryCarrierAndDeliveryMethodsById]
GO
/****** Object:  StoredProcedure [dbo].[GetSecurityPermissionByUserId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetSecurityPermissionByUserId]
GO
/****** Object:  StoredProcedure [dbo].[GetRolesMappingByRoleId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetRolesMappingByRoleId]
GO
/****** Object:  StoredProcedure [dbo].[GetRoles]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetRoles]
GO
/****** Object:  StoredProcedure [dbo].[GetRoleByRoleId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetRoleByRoleId]
GO
/****** Object:  StoredProcedure [dbo].[GetPhoneByContactId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetPhoneByContactId]
GO
/****** Object:  StoredProcedure [dbo].[GetEmailByContactId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetEmailByContactId]
GO
/****** Object:  StoredProcedure [dbo].[GetDetailsByCustomerId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetDetailsByCustomerId]
GO
/****** Object:  StoredProcedure [dbo].[GetDeliveryMethodsCustomerId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetDeliveryMethodsCustomerId]
GO
/****** Object:  StoredProcedure [dbo].[GetDefaultPaymentTemplete]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetDefaultPaymentTemplete]
GO
/****** Object:  StoredProcedure [dbo].[GetCustomersBasicInformationById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetCustomersBasicInformationById]
GO
/****** Object:  StoredProcedure [dbo].[GetCustomers]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetCustomers]
GO
/****** Object:  StoredProcedure [dbo].[GetCustomerNotesByCustomerId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetCustomerNotesByCustomerId]
GO
/****** Object:  StoredProcedure [dbo].[GetCustomerDocumentsById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetCustomerDocumentsById]
GO
/****** Object:  StoredProcedure [dbo].[GetCustomerAuditHistoryByCustomerId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetCustomerAuditHistoryByCustomerId]
GO
/****** Object:  StoredProcedure [dbo].[GetContactBySupplierId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetContactBySupplierId]
GO
/****** Object:  StoredProcedure [dbo].[GetContactByCustomerId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetContactByCustomerId]
GO
/****** Object:  StoredProcedure [dbo].[GetCheckListItemByListId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetCheckListItemByListId]
GO
/****** Object:  StoredProcedure [dbo].[GetAllUser]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllUser]
GO
/****** Object:  StoredProcedure [dbo].[GetAllTerritories]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllTerritories]
GO
/****** Object:  StoredProcedure [dbo].[GetAllSupplierType]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllSupplierType]
GO
/****** Object:  StoredProcedure [dbo].[GetAllStates]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllStates]
GO
/****** Object:  StoredProcedure [dbo].[GetAllRoles]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllRoles]
GO
/****** Object:  StoredProcedure [dbo].[GetAllResponseuser]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllResponseuser]
GO
/****** Object:  StoredProcedure [dbo].[GetAllPhoneTypes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllPhoneTypes]
GO
/****** Object:  StoredProcedure [dbo].[GetAllPaymentMethod]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllPaymentMethod]
GO
/****** Object:  StoredProcedure [dbo].[GetAllPagesByRoleId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllPagesByRoleId]
GO
/****** Object:  StoredProcedure [dbo].[GetAllGroupTypes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllGroupTypes]
GO
/****** Object:  StoredProcedure [dbo].[GetAllDocumentTypes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllDocumentTypes]
GO
/****** Object:  StoredProcedure [dbo].[GetAllDeliveryMethods]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllDeliveryMethods]
GO
/****** Object:  StoredProcedure [dbo].[GetAllDeliveryCarriers]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllDeliveryCarriers]
GO
/****** Object:  StoredProcedure [dbo].[GetAllDeliveryAccounts]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllDeliveryAccounts]
GO
/****** Object:  StoredProcedure [dbo].[GetAllCountries]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllCountries]
GO
/****** Object:  StoredProcedure [dbo].[GetAllContactTypes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllContactTypes]
GO
/****** Object:  StoredProcedure [dbo].[GetAllCities]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllCities]
GO
/****** Object:  StoredProcedure [dbo].[GetAllAddressTypes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAllAddressTypes]
GO
/****** Object:  StoredProcedure [dbo].[GetAddresssBySupplierId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAddresssBySupplierId]
GO
/****** Object:  StoredProcedure [dbo].[GetAddresssByCustomerId]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[GetAddresssByCustomerId]
GO
/****** Object:  StoredProcedure [dbo].[DeleteUser]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteUser]
GO
/****** Object:  StoredProcedure [dbo].[DeleteSupplierDocuementById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteSupplierDocuementById]
GO
/****** Object:  StoredProcedure [dbo].[DeleteRolesMapping]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteRolesMapping]
GO
/****** Object:  StoredProcedure [dbo].[DeleteRoles]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteRoles]
GO
/****** Object:  StoredProcedure [dbo].[DeleteCustomerDocumentsById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteCustomerDocumentsById]
GO
/****** Object:  StoredProcedure [dbo].[DeleteCustomerDeliveryMethodsById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteCustomerDeliveryMethodsById]
GO
/****** Object:  StoredProcedure [dbo].[DeleteCustomerDeliveryCarriersById]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteCustomerDeliveryCarriersById]
GO
/****** Object:  StoredProcedure [dbo].[DeleteContactPhone]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteContactPhone]
GO
/****** Object:  StoredProcedure [dbo].[DeleteContactEmail]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[DeleteContactEmail]
GO
/****** Object:  StoredProcedure [dbo].[CheckSupplierNameExist]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[CheckSupplierNameExist]
GO
/****** Object:  StoredProcedure [dbo].[CheckDocumentsExistOrNot]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[CheckDocumentsExistOrNot]
GO
/****** Object:  StoredProcedure [dbo].[CheckCustomerNameExist]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[CheckCustomerNameExist]
GO
/****** Object:  StoredProcedure [dbo].[AddUsers]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddUsers]
GO
/****** Object:  StoredProcedure [dbo].[AddUserCheckListResponse]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddUserCheckListResponse]
GO
/****** Object:  StoredProcedure [dbo].[AddSupplierNotes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddSupplierNotes]
GO
/****** Object:  StoredProcedure [dbo].[AddSupplierDocuments]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddSupplierDocuments]
GO
/****** Object:  StoredProcedure [dbo].[AddShppingDeliveryCarriers]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddShppingDeliveryCarriers]
GO
/****** Object:  StoredProcedure [dbo].[AddSecurityPermissions]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddSecurityPermissions]
GO
/****** Object:  StoredProcedure [dbo].[AddRoles]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddRoles]
GO
/****** Object:  StoredProcedure [dbo].[AddRoleMapping]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddRoleMapping]
GO
/****** Object:  StoredProcedure [dbo].[AddEditSupplierBasicInformation]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddEditSupplierBasicInformation]
GO
/****** Object:  StoredProcedure [dbo].[AddEditCustomerSettings]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddEditCustomerSettings]
GO
/****** Object:  StoredProcedure [dbo].[AddEditContactPhone]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddEditContactPhone]
GO
/****** Object:  StoredProcedure [dbo].[AddEditContactForSupplier]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddEditContactForSupplier]
GO
/****** Object:  StoredProcedure [dbo].[AddEditContactForCustomer]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddEditContactForCustomer]
GO
/****** Object:  StoredProcedure [dbo].[AddEditContactEmail]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddEditContactEmail]
GO
/****** Object:  StoredProcedure [dbo].[AddEditContact]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddEditContact]
GO
/****** Object:  StoredProcedure [dbo].[AddDeliveryMethods]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddDeliveryMethods]
GO
/****** Object:  StoredProcedure [dbo].[AddCustomerShppingDeliveryCarriersAndDeliveryMethods]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddCustomerShppingDeliveryCarriersAndDeliveryMethods]
GO
/****** Object:  StoredProcedure [dbo].[AddCustomersBasicInformation]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddCustomersBasicInformation]
GO
/****** Object:  StoredProcedure [dbo].[AddCustomerNotes]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddCustomerNotes]
GO
/****** Object:  StoredProcedure [dbo].[AddCustomerDocuments]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddCustomerDocuments]
GO
/****** Object:  StoredProcedure [dbo].[AddContactPhone]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddContactPhone]
GO
/****** Object:  StoredProcedure [dbo].[AddContactEmail]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddContactEmail]
GO
/****** Object:  StoredProcedure [dbo].[AddAddressForSupplier]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddAddressForSupplier]
GO
/****** Object:  StoredProcedure [dbo].[AddAddressForCustomer]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddAddressForCustomer]
GO
/****** Object:  StoredProcedure [dbo].[AddAddress]    Script Date: 28-06-2024 19:19:44 ******/
DROP PROCEDURE [dbo].[AddAddress]
GO
/****** Object:  UserDefinedTableType [dbo].[SecurityPermissionsType]    Script Date: 28-06-2024 19:19:44 ******/
DROP TYPE [dbo].[SecurityPermissionsType]
GO
/****** Object:  UserDefinedTableType [dbo].[PhoneTypeTable]    Script Date: 28-06-2024 19:19:44 ******/
DROP TYPE [dbo].[PhoneTypeTable]
GO
/****** Object:  UserDefinedTableType [dbo].[EmailTypeTable]    Script Date: 28-06-2024 19:19:44 ******/
DROP TYPE [dbo].[EmailTypeTable]
GO
/****** Object:  UserDefinedTableType [dbo].[CheckListResponseTypeTable]    Script Date: 28-06-2024 19:19:44 ******/
DROP TYPE [dbo].[CheckListResponseTypeTable]
GO
/****** Object:  UserDefinedTableType [dbo].[CheckListResponseTypeTable]    Script Date: 28-06-2024 19:19:44 ******/
CREATE TYPE [dbo].[CheckListResponseTypeTable] AS TABLE(
	[IsApproved] [bit] NULL,
	[ChecklistItemId] [int] NULL,
	[UserId] [int] NULL
)
GO
/****** Object:  UserDefinedTableType [dbo].[EmailTypeTable]    Script Date: 28-06-2024 19:19:44 ******/
CREATE TYPE [dbo].[EmailTypeTable] AS TABLE(
	[EmailId] [int] NULL,
	[EmailAddress] [nvarchar](255) NULL,
	[IsPrimary] [bit] NULL,
	[OwnerTypeId] [tinyint] NULL,
	[CreatedBy] [smallint] NULL
)
GO
/****** Object:  UserDefinedTableType [dbo].[PhoneTypeTable]    Script Date: 28-06-2024 19:19:44 ******/
CREATE TYPE [dbo].[PhoneTypeTable] AS TABLE(
	[PhoneId] [int] NULL,
	[PhoneNumber] [varchar](20) NULL,
	[PhoneCode] [varchar](20) NULL,
	[PhoneTypeId] [smallint] NULL,
	[Extension] [int] NULL,
	[IsPrimary] [bit] NULL,
	[OwnerTypeId] [tinyint] NULL,
	[CreatedBy] [smallint] NULL
)
GO
/****** Object:  UserDefinedTableType [dbo].[SecurityPermissionsType]    Script Date: 28-06-2024 19:19:44 ******/
CREATE TYPE [dbo].[SecurityPermissionsType] AS TABLE(
	[SecuritySettingId] [tinyint] NULL,
	[SecurityKeyId] [smallint] NULL,
	[RoleId] [tinyint] NULL
)
GO
/****** Object:  StoredProcedure [dbo].[AddAddress]    Script Date: 28-06-2024 19:19:44 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddAddress]            
@CustomerId int,      
@AddressTypeId SMALLINT,      
@AddressLine1 VARCHAR(250),      
@AddressLine2 VARCHAR(250),      
@AddressLine3 VARCHAR(250),      
@AddressLine4 VARCHAR(250),      
@AddressLine5 VARCHAR(250),      
@CountryId SMALLINT,      
@StateId int,      
@CityId int,      
@ZipCode int,      
@CreatedBy SMALLINT                              
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
 BEGIN TRY                            
  DECLARE @keyId AS INT    
        DECLARE @AddressType VARCHAR(100);    
        DECLARE @Title VARCHAR(100);     
    
        
        SELECT @AddressType = Type    
        FROM [dbo].[AddressTypes]    
        WHERE [AddressTypeId] = @AddressTypeId;                        
             
        IF EXISTS (SELECT 1 FROM [dbo].[Addresses] WHERE [AddressLine1] = @AddressLine1 AND [AddressLine2]=@AddressLine2 AND [CountryId]=@CountryId    
        AND [StateId]=@StateId AND [CityId]=@CityId AND DeletedAt IS NULL AND CreatedBy IS NULL)    
        AND EXISTS(SELECT 1 FROM [dbo].[AddressTypes] WHERE [AddressTypeId]=@AddressTypeId)      
        BEGIN    
            SELECT CAST(0 AS INT) as KeyValue,     
            'Address already exists.' as ErrorMessage;    
        END    
        ELSE    
        BEGIN    
   INSERT INTO [dbo].[Addresses]      
   (              
                 Title,         
                AddressLine1,            
                AddressLine2,            
                AddressLine3,            
                AddressLine4,            
                AddressLine5,            
                CountryId,            
                StateId,            
                CityId,          
                ZipCode,        
                CreatedBy,                  
                CreatedAt                 
   )                  
   VALUES                
   (        
                '',    
                @AddressLine1,      
                @AddressLine2,      
                @AddressLine3,      
                @AddressLine4,      
                @AddressLine5,      
                @CountryId,      
                @StateId,      
                @CityId,      
                @ZipCode,      
                @CreatedBy,                  
                GETDATE()                  
   )                  
                  
            SET  @keyId = SCOPE_IDENTITY()                          
                
            SET @Title = CAST(@keyId AS VARCHAR(50)) + '_' + @AddressLine1 + '_' + @AddressType;    
    
            UPDATE [dbo].[Addresses] SET Title = @Title WHERE AddressId = @keyId;      
       
            SELECT @keyId as KeyValue,                           
            'Address Information Added' as ErrorMessage                     
            
           --IF @keyId > 0            
           --BEGIN            
           -- INSERT INTO [dbo].[L_CustomerAddresses](CustomerId,AddressId,AddressTypeId,StatusId,CreatedBy,CreatedAt)            
           -- VALUES(@CustomerId,@keyId,@AddressTypeId,1,@CreatedBy,GETDATE())            
           --END     
  END     
                  
END TRY                              
BEGIN CATCH                            
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                            
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                            
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                            
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                            
END CATCH                            
END 
GO
/****** Object:  StoredProcedure [dbo].[AddAddressForCustomer]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddAddressForCustomer]        
@CustomerId int,      
@AddressTypeId SMALLINT,      
@AddressId INT,  
@IsPreferredBilling bit,  
@IsPreferredShipping bit, 
@CreatedBy SMALLINT           
AS        
BEGIN        
 SET NOCOUNT ON;        
BEGIN TRY                      
   DECLARE @keyId AS INT          
        
   INSERT INTO [dbo].[L_CustomerAddresses]     
  (     
   CustomerId,  
   AddressId,  
   AddressTypeId,  
   IsPreferredBilling,  
   IsPreferredShipping,  
   StatusId,    
   CreatedBy,        
   CreatedAt       
  )        
  VALUES      
  (    
   @CustomerId,  
   @AddressId,  
   @AddressTypeId,  
   @IsPreferredBilling,  
   @IsPreferredShipping,  
   1,    
   @CreatedBy,        
   GETDATE()        
  )        
        
   SET  @keyId = SCOPE_IDENTITY()                
        
   SELECT @keyId as KeyValue,                 
   'Customer address linkup Added' as ErrorMessage               
    
END TRY                    
BEGIN CATCH                  
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                  
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                  
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                  
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                  
END CATCH                  
END 
GO
/****** Object:  StoredProcedure [dbo].[AddAddressForSupplier]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddAddressForSupplier]          
@SupplierId int,        
@AddressTypeId SMALLINT,        
@AddressId INT,      
@CreatedBy SMALLINT             
AS          
BEGIN          
 SET NOCOUNT ON;          
BEGIN TRY                        
   DECLARE @keyId AS INT            
          
   INSERT INTO [dbo].[L_SupplierAddresses]       
  (       
   SupplierId,    
   AddressId,    
   AddressTypeId,  
   StatusId,      
   CreatedBy,          
   CreatedAt         
  )          
  VALUES        
  (      
   @SupplierId,    
   @AddressId,    
   @AddressTypeId,     
   1,      
   @CreatedBy,          
   GETDATE()          
  )          
          
   SET  @keyId = SCOPE_IDENTITY()                  
          
   SELECT @keyId as KeyValue,                   
   'Supplier address linkup Added' as ErrorMessage                 
          
END TRY                      
BEGIN CATCH                    
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                    
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                    
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                    
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                    
END CATCH                    
END 
GO
/****** Object:  StoredProcedure [dbo].[AddContactEmail]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
        
         
CREATE PROCEDURE [dbo].[AddContactEmail]                  
@EmailAddress VARCHAR(255),          
@ContactId INT,        
@CreatedBy SMALLINT        
        
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                                  
   DECLARE @keyId AS INT                    
   DECLARE @existingEmailCount AS INT        
           
     IF EXISTS (SELECT 1 FROM [dbo].[Emails] WHERE EmailAddress=@EmailAddress AND OwnerId=@ContactId AND DeletedAt IS NULL AND DeletedBy IS NULL)            
     BEGIN          
         SELECT CAST(0 AS INT) as KeyValue,           
         'Email address already exists.' as ErrorMessage;          
     END          
   ELSE          
   BEGIN          
    SELECT @existingEmailCount = COUNT(*) FROM [dbo].[Emails] WHERE OwnerId = @ContactId AND OwnerTypeId=3 AND DeletedAt IS NULL AND DeletedBy IS NULL        
        
    IF @existingEmailCount < 2        
 BEGIN        
     INSERT INTO [dbo].[Emails]                  
    (        
     EmailAddress,        
     OwnerId,        
     OwnerTypeId,        
     CreatedBy,                  
     CreatedAt                 
    )                  
    VALUES                
    (              
   @EmailAddress,        
   @ContactId,        
   3,      
   @CreatedBy,                  
   GETDATE()                  
    )                  
                  
     SET  @keyId = SCOPE_IDENTITY()                          
             
     SELECT @keyId as KeyValue,                           
     'Contact email address Added' as ErrorMessage        
   END        
   ELSE        
   BEGIN        
   SELECT CAST(0 AS BIGINT) as KeyValue,           
   'This contact can only have two email addresses.' as ErrorMessage;        
   END        
   END        
END TRY                          
BEGIN CATCH                            
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                            
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                            
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                            
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                            
END CATCH                            
END 
GO
/****** Object:  StoredProcedure [dbo].[AddContactPhone]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
CREATE PROCEDURE [dbo].[AddContactPhone]                
@PhoneNumber VARCHAR(20),      
@PhoneCode VARCHAR(10),      
@ContactId INT,      
@PhoneTypeId SMALLINT,      
@CreatedBy SMALLINT      
      
AS                
BEGIN                
 SET NOCOUNT ON;                
BEGIN TRY                                
   DECLARE @keyId AS INT                  
   DECLARE @existingPhoneCount AS INT      
         
    IF EXISTS (SELECT 1 FROM [dbo].[Phones] WHERE PhoneNumber=@PhoneNumber AND OwnerId = @ContactId AND DeletedAt IS NULL AND DeletedBy IS NULL )          
 BEGIN        
  SELECT CAST(0 AS INT) as KeyValue,         
  'Phone Number already exists.' as ErrorMessage;        
 END        
 ELSE        
 BEGIN      
    SELECT @existingPhoneCount = COUNT(*) FROM [dbo].[Phones] WHERE OwnerId = @ContactId AND DeletedAt IS NULL AND DeletedBy IS NULL      
      
    IF @existingPhoneCount < 5     BEGIN      
     INSERT INTO [dbo].[Phones]                
    (      
     PhoneNumber,      
     PhoneCode,      
     OwnerId,      
     OwnerTypeId,      
     PhoneTypeId,      
     CreatedBy,                
     CreatedAt               
    )                
    VALUES              
    (            
   @PhoneNumber,      
   @PhoneCode,      
   @ContactId,      
   3,      
   @PhoneTypeId,      
   @CreatedBy,                
   GETDATE()                
    )                
                
     SET  @keyId = SCOPE_IDENTITY()                        
           
     SELECT @keyId as KeyValue,                         
     'Contact phone number Added' as ErrorMessage      
   END      
   ELSE      
   BEGIN      
   SELECT CAST(0 AS BIGINT) as KeyValue,      
 'This contact can only have five phone number' as ErrorMessage;      
   END      
    END      
END TRY                        
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                          
END 
GO
/****** Object:  StoredProcedure [dbo].[AddCustomerDocuments]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--AddCustomerDocuments    
CREATE PROCEDURE [dbo].[AddCustomerDocuments]                        
@Name VARCHAR(75),                        
@DocumentTypeId TINYINT,                        
@CustomerId INT,                        
@Attachment NVARCHAR(255),                   
@CreatedBy SMALLINT                              
                              
AS                              
BEGIN                              
 SET NOCOUNT ON;                              
BEGIN TRY                                        
    DECLARE @keyId AS INT                                
                   
                
        IF EXISTS (SELECT 1 FROM [dbo].[CustomerDocuments] WHERE DocumentTypeId = @DocumentTypeId AND CustomerId=@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL)                         
            BEGIN                    
                SELECT CAST(0 AS INT) as KeyValue,                                                        
                'Document exists on this type, Only one document per type' as ErrorMessage                           
            END         
        ELSE IF EXISTS (SELECT 1 FROM [dbo].[CustomerDocuments] WHERE Name = @Name AND CustomerId=@CustomerId)                    
             BEGIN                 
                SELECT CAST(0 AS INT) as KeyValue,                                      
                'Document name already exists' as ErrorMessage                          
              END                   
       ELSE                  
            BEGIN                  
                INSERT INTO [dbo].[CustomerDocuments]                             
                (                        
                    Name,          
                    DocumentTypeId,          
                    CustomerId,          
                    Attachment,          
                    StatusId,                      
                    CreatedBy,                              
                    CreatedAt                             
                )                              
                VALUES                            
                (                        
                    @Name,          
                    @DocumentTypeId,          
                    @CustomerId,          
                    @Attachment,            
                    1,                
                    @CreatedBy,                              
                    GETDATE()                              
                )                              
                              
                SET  @keyId = SCOPE_IDENTITY()                                      
                              
                SELECT @keyId as KeyValue,                                       
                'Document Added' as ErrorMessage                                 
            END                  
                              
END TRY                                          
BEGIN CATCH                                        
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                                        
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                                        
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                                        
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                                        
END CATCH                                        
END 
GO
/****** Object:  StoredProcedure [dbo].[AddCustomerNotes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE  [dbo].[AddCustomerNotes]
	-- Add the parameters for the stored procedure here
	 @CustomerId int,	
	@Note nvarchar(1000),
	 @CreatedBy smallint
As
	BEGIN      
	SET NOCOUNT ON;      
	BEGIN TRY                
		IF EXISTS (SELECT CustomerNoteId FROM [dbo].[CustomerNotes] WHERE Note=@Note )      
			BEGIN      
			   SELECT CAST(0 AS SMALLINT) as KeyValue,               
			  'Notes EXISTS ' as ErrorMessage         
			END      
		ELSE      
		BEGIN       
		 DECLARE @keyId AS BIGINT        
      
		   INSERT INTO [dbo].[CustomerNotes]      
			  (
			   CustomerId,
			   Note,
			   CreatedBy,
				CreatedAt
			  )      
			  VALUES    
			  (
				@CustomerId,
				@Note ,
				@CreatedBy, 
				GETDATE()
			  )      
		   SET  @keyId = SCOPE_IDENTITY()              
		   SELECT @keyId as KeyValue,               
		   'Note Added' as ErrorMessage         
		END      
      
	END TRY                  
	BEGIN CATCH                
	 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
	 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                
	 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                
	 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
	END CATCH                
END 
GO
/****** Object:  StoredProcedure [dbo].[AddCustomersBasicInformation]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddCustomersBasicInformation]                
@Name VARCHAR(200),                
@GroupTypeId SMALLINT,                
@TerritoryId VARCHAR(150),                
@CountryId SMALLINT,                
@EmailAddress VARCHAR(255),                
@Website NVARCHAR(250),                  
@Note VARCHAR(200),                
@IsCompany bit,    
@TaxId VARCHAR(15),            
@CreatedBy SMALLINT,  
@IsBuyingForThirdParty bit,
@ResponsibleUserId SMALLINT
                      
AS                      
BEGIN                      
 SET NOCOUNT ON;                      
BEGIN TRY                                
    DECLARE @keyId AS INT                        
           
        IF EXISTS (SELECT 1 FROM [dbo].[Customers] WHERE Name = @Name)                 
     BEGIN            
         SELECT CAST(0 AS INT) as KeyValue,                                                
            'Customer already exists.' as ErrorMessage                 
        END            
        ELSE IF EXISTS (SELECT 1 FROM [dbo].[Customers] WHERE TaxId = @TaxId AND Name = @Name) OR EXISTS (SELECT 1 FROM [dbo].[Customers] WHERE TaxId = @TaxId)              
        BEGIN           
            SELECT CAST(0 AS INT) as KeyValue,                                
            'Taxid already exists.' as ErrorMessage              
        END                 
        ELSE          
            BEGIN          
            INSERT INTO [dbo].[Customers]                      
            (                
            Name,              
            GroupTypeId,                
            TerritoryId,                
            CountryId,                
            Website,                       
            IsCompany,                
            TaxId,                 
            StatusId,        
            IsActive,        
            CreatedBy,                      
            CreatedAt,  
            IsBuyingForThirdParty,
			ResponsibleUserId
            )                      
            VALUES                    
            (                
            @Name,              
            @GroupTypeId,                   
            @TerritoryId,                
            @CountryId,                
            @Website,                   
            @IsCompany,                   
            @TaxId,                  
            1,        
            1,        
            @CreatedBy,                      
            GETDATE(),  
            @IsBuyingForThirdParty,
			@ResponsibleUserId
            )                      
                      
            SET  @keyId = SCOPE_IDENTITY()                              
                      
            SELECT @keyId as KeyValue,                               
            'Customers Information Added' as ErrorMessage                         
            END          
            IF @keyId > 0                
            BEGIN                
            INSERT INTO [dbo].[Emails](EmailAddress,OwnerId,OwnerTypeId,CreatedBy,CreatedAt)                
            VALUES(@EmailAddress,@keyId,1,@CreatedBy,GETDATE())                
                
                 
            INSERT INTO [dbo].[CustomerNotes](Note,CustomerId,CreatedBy,CreatedAt)                
            VALUES(@Note,@keyId,@CreatedBy,GETDATE())                
        END          
                      
END TRY                                  
BEGIN CATCH                                
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                                
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                                
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                                
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                                
END CATCH                                
END 
GO
/****** Object:  StoredProcedure [dbo].[AddCustomerShppingDeliveryCarriersAndDeliveryMethods]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
        
--AddCustomerShppingDeliveryCarriersAndDeliveryMethods 1,6,1,109        
CREATE PROCEDURE [dbo].[AddCustomerShppingDeliveryCarriersAndDeliveryMethods]           
@DeliveryAccountId INT,        
@CustomerId INT,
@IsByDefault bit,          
@CreatedBy smallint          
AS          
BEGIN          
    SET NOCOUNT ON;                      
    BEGIN TRY                                      
        DECLARE @keyId AS INT;      
        DECLARE @ExistingDeliveryAccountId INT;          
              
        BEGIN        
            IF NOT EXISTS (SELECT 1 FROM [dbo].[CustomerAccoutingSettings] WHERE CustomerId = @CustomerId)        
            BEGIN              
                INSERT INTO [dbo].[CustomerAccoutingSettings](DeliveryAccountId,CustomerId,CreatedBy,CreatedAt)                      
                VALUES(@DeliveryAccountId,@CustomerId,@CreatedBy,GETDATE());                      
            END        
            ELSE        
            BEGIN        
               SELECT @ExistingDeliveryAccountId = DeliveryAccountId FROM [dbo].[CustomerAccoutingSettings] WHERE CustomerId = @CustomerId;      
                 
               IF @ExistingDeliveryAccountId != @DeliveryAccountId OR @ExistingDeliveryAccountId IS NULL    
               BEGIN      
                    UPDATE [dbo].[CustomerAccoutingSettings] SET DeliveryAccountId=@DeliveryAccountId  WHERE CustomerId=@CustomerId      
      
                    UPDATE [dbo].[L_CustomCharge_CustomerDeliveryMethods] SET      
                    DeletedBy=@CreatedBy,DeletedAt=GETDATE(),UpdatedBy=@CreatedBy,UpdatedAt=GETDATE() WHERE CustomerId=@CustomerId      
      
                    UPDATE [dbo].[L_CustomerDeliveryCarriers] SET      
                    DeletedBy=@CreatedBy,DeletedAt=GETDATE(),UpdatedBy=@CreatedBy,UpdatedAt=GETDATE() WHERE CustomerId=@CustomerId        
               END          
            END        
          
            IF @IsByDefault = 1
            BEGIN          
                IF @DeliveryAccountId=1        
                BEGIN        
                    IF NOT EXISTS (SELECT 1 FROM [dbo].[L_CustomCharge_CustomerDeliveryMethods] WHERE CustomerId = @CustomerId AND DeletedBy IS NULL AND DeletedAt IS   NULL AND DeliveryMethodId IN (SELECT DeliveryMethodId FROM [dbo].[DeliveryMethods]))       
 
                    BEGIN        
                        INSERT INTO [dbo].[L_CustomCharge_CustomerDeliveryMethods](CustomerId,DeliveryMethodId,Charge,CreatedBy,CreatedAt)        
                        SELECT @CustomerId,DeliveryMethodId,Charge,@CreatedBy,GETDATE() FROM [dbo].[DeliveryMethods] ORDER BY DeliveryMethodId ASC      
      
                        SELECT CAST(0 AS INT) as KeyValue,               
                        'Customer Delivery Methods added.' as ErrorMessage;         
                    END      
                END        
        
                IF @DeliveryAccountId=2        
                BEGIN        
                    IF NOT EXISTS (SELECT 1 FROM [dbo].[L_CustomerDeliveryCarriers] WHERE CarrierId IN (SELECT CarrierId FROM [dbo].[DeliveryCarriers])AND CustomerId = @CustomerId AND DeletedBy IS NULL AND DeletedAt IS NULL)        
                    BEGIN        
                        INSERT INTO [dbo].[L_CustomerDeliveryCarriers](CarrierId,CustomerId,CreatedAt,CreatedBy)        
                        SELECT CarrierId,@CustomerId,GETDATE(),@CreatedBy FROM [dbo].[DeliveryCarriers] ORDER BY CarrierId ASC        
                    END        
        
                    IF NOT EXISTS (SELECT 1 FROM [dbo].[L_CustomCharge_CustomerDeliveryMethods] WHERE CustomerId = @CustomerId AND DeletedBy IS NULL AND DeletedAt IS NULL AND DeliveryMethodId IN (SELECT DeliveryMethodId FROM [dbo].[DeliveryMethods]))        
                    BEGIN        
                        INSERT INTO [dbo].[L_CustomCharge_CustomerDeliveryMethods](CustomerId,DeliveryMethodId,Charge,CreatedAt,CreatedBy)        
                        SELECT @CustomerId,DeliveryMethodId,Charge,GETDATE(),@CreatedBy FROM [dbo].[DeliveryMethods] ORDER BY DeliveryMethodId ASC        
                    END      
      
                    SELECT CAST(0 AS INT) as KeyValue,               
                    'Customer delivery Carrier added.' as ErrorMessage;                     
                END   
            END     
  END          
                 
    END TRY                              
    BEGIN CATCH                                
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                                
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();                                
        DECLARE @ErrorState INT = ERROR_STATE();                                
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                                
    END CATCH;          
END; 
GO
/****** Object:  StoredProcedure [dbo].[AddDeliveryMethods]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddDeliveryMethods]          
@CustomerId INT,  
@DeliveryMethodId TINYINT,  
@Charge DECIMAL,  
@IsPrimary BIT,        
@CreatedBy SMALLINT                  
AS          
BEGIN          
 SET NOCOUNT ON;   
 DECLARE @keyId AS INT                   
  
BEGIN TRY                    
    IF EXISTS (SELECT DeliveryMethodId FROM [dbo].[L_CustomCharge_CustomerDeliveryMethods] WHERE DeliveryMethodId=@DeliveryMethodId  AND CustomerId=@CustomerId And DeletedBy is null And DeletedAt is null )          
    BEGIN          
        SELECT CAST(0 AS TINYINT) as KeyValue,                   
        'Delivery Methods EXISTS' as ErrorMessage             
    END          
    ELSE          
    BEGIN  
        IF @IsPrimary =1    
        BEGIN    
            UPDATE [dbo].[L_CustomCharge_CustomerDeliveryMethods] SET    
            IsPrimary=0    
            WHERE CustomerId =@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL    
        END  
   
        INSERT INTO [dbo].[L_CustomCharge_CustomerDeliveryMethods]          
        (       
            CustomerId,  
            DeliveryMethodId,  
            Charge,  
            IsPrimary,      
            CreatedBy,          
            CreatedAt         
        )          
        VALUES        
        (     
            @CustomerId,  
            @DeliveryMethodId,  
            @Charge,       
            @IsPrimary,      
            @CreatedBy,          
            GETDATE()          
        )          
          
        SET  @keyId = SCOPE_IDENTITY()                  
          
        SELECT @keyId as KeyValue,                   
        'Delivery Methods Added' as ErrorMessage             
    END          
          
END TRY                      
BEGIN CATCH                    
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                    
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                    
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                    
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                    
END CATCH                    
END 
GO
/****** Object:  StoredProcedure [dbo].[AddEditContact]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--AddEditContact 15,5,'test','shiva',6          
          
CREATE PROCEDURE [dbo].[AddEditContact]                        
    @CustomerId INT,                
    @ContactTypeId SMALLINT,                
    @FirstName VARCHAR(50),                
    @LastName VARCHAR(50),                
    @CreatedBy SMALLINT,                    
    @ContactId INT = 0,        
    @CustomerContactId INT,      
    @IsPrimary INT                      
AS                        
BEGIN                        
    SET NOCOUNT ON;                        
    BEGIN TRY                                        
        DECLARE @keyId AS INT;            
        DECLARE @Action VARCHAR(50);            
            
        IF @ContactId > 0            
        BEGIN            
            IF EXISTS (SELECT 1 FROM [dbo].[Contacts] WHERE ContactId = @ContactId)            
            BEGIN     
                IF EXISTS (SELECT 1 FROM [dbo].[Contacts] WHERE ContactId = @ContactId AND (FirstName != @FirstName OR LastName != @LastName))    
                BEGIN           
                    UPDATE [dbo].[Contacts]            
                    SET            
                        FirstName = @FirstName,            
                        LastName = @LastName,          
                        UpdatedBy = @CreatedBy,            
                        UpdatedAt = GETDATE()            
                    WHERE            
                        ContactId = @ContactId;            
                        
                    IF @CustomerContactId > 0  
                    BEGIN  
                        IF EXISTS (SELECT 1 FROM [dbo].[L_CustomerContacts]   
                                   WHERE CustomerContactId = @CustomerContactId   
                                   AND ContactTypeId != @ContactTypeId)  
                        BEGIN  
                            UPDATE [dbo].[L_CustomerContacts]  
                            SET ContactTypeId = @ContactTypeId  
                            WHERE CustomerContactId = @CustomerContactId;  
                        END
                            UPDATE [dbo].[Contacts] SET UpdatedBy = @CreatedBy,UpdatedAt = GETDATE()WHERE            
                            ContactId = @ContactId;              
                    END         
          
                    SELECT @ContactId as KeyValue,                
                    'Contact details updated' AS ErrorMessage;             
                END    
                ELSE            
                BEGIN            
                    SELECT @ContactId as KeyValue,                
                    'Contact details updated' AS ErrorMessage;    
                END     
            END    
            ELSE            
            BEGIN            
                SELECT CAST(0 AS INT) AS KeyValue,               
                'NO RECORD FOUND' AS ErrorMessage;    
            END          
        END            
        ELSE            
        BEGIN            
            IF EXISTS (SELECT 1 FROM [dbo].[Contacts] WHERE [FirstName] = @FirstName AND [LastName] = @LastName)               
            AND EXISTS(SELECT 1 FROM [dbo].[L_CustomerContacts] WHERE [ContactTypeId] = @ContactTypeId AND ContactId= @ContactId AND CustomerId=@CustomerId)              
            BEGIN              
                SELECT CAST(0 AS INT) AS KeyValue,               
                'Contact already exists.' AS ErrorMessage;            
            END              
            ELSE              
            BEGIN              
                INSERT INTO [dbo].[Contacts]                        
                (                     
                    FirstName,                
                    LastName,                
                    CreatedBy,                        
                    CreatedAt                       
                )                        
                VALUES                      
                (                    
                    @FirstName,                
                    @LastName,                
                    @CreatedBy,                        
                    GETDATE()                        
                );                        
                 
                SET @keyId = SCOPE_IDENTITY();            
        
                SELECT @keyId as KeyValue,                                 
               'Contact details added' as ErrorMessage         
                           
            END              
            END         
        
            --IF @keyId > 0                          
            --BEGIN            
            --    INSERT INTO [dbo].[L_CustomerContacts](CustomerId, ContactId, ContactTypeId, StatusId,IsPrimary,CreatedBy, CreatedAt)                          
            --    VALUES(@CustomerId, @keyId, @ContactTypeId, 1,@IsPrimary,@CreatedBy, GETDATE());            
            --END           
            
    END TRY                                
    BEGIN CATCH                                  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                                  
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();                                  
        DECLARE @ErrorState INT = ERROR_STATE();                                  
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                                  
    END CATCH;            
END; 
GO
/****** Object:  StoredProcedure [dbo].[AddEditContactEmail]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
                
                
                
CREATE PROCEDURE [dbo].[AddEditContactEmail]                
    @EmailList EmailTypeTable READONLY,                
    @ContactId INT            
AS                
BEGIN                
    SET NOCOUNT ON;                
                
    -- Create a temporary table to hold the emails                
    CREATE TABLE #TempEmails (                
        EmailId INT,                
        EmailAddress NVARCHAR(255),    
        IsPrimary BIT,    
        OwnerTypeId TINYINT,              
        CreatedBy SMALLINT                
    );                
                
    -- Insert data from the EmailList into the temporary table                
    INSERT INTO #TempEmails (EmailId, EmailAddress,IsPrimary,OwnerTypeId,CreatedBy)                
    SELECT EmailId, EmailAddress,IsPrimary,OwnerTypeId,CreatedBy                
    FROM @EmailList;                
                
    BEGIN TRY                
        -- Update existing email addresses                
        UPDATE e                
        SET e.EmailAddress = t.EmailAddress,    
            e.IsPrimary=t.IsPrimary,                
            e.UpdatedAt = GETDATE(),                
            e.UpdatedBy = t.CreatedBy                
        FROM [dbo].[Emails] e                
        INNER JOIN #TempEmails t ON e.EmailId = t.EmailId                
        WHERE e.OwnerId = @ContactId AND e.OwnerTypeId = t.OwnerTypeId AND DeletedAt IS NULL AND DeletedBy IS NULL      
        AND e.EmailAddress <> t.EmailAddress OR e.IsPrimary<>t.IsPrimary;                  
                
        -- Insert new email addresses                
        INSERT INTO [dbo].[Emails] (EmailAddress,IsPrimary, OwnerId, OwnerTypeId, CreatedAt, CreatedBy)                
        SELECT t.EmailAddress,t.IsPrimary,@ContactId, t.OwnerTypeId, GETDATE(), t.CreatedBy                
        FROM #TempEmails t                
        LEFT JOIN [dbo].[Emails] e                
        ON e.EmailId = t.EmailId                
        AND e.OwnerId = @ContactId                
        AND e.OwnerTypeId = t.OwnerTypeId                
        WHERE e.EmailAddress IS NULL;                
                
    END TRY                
    BEGIN CATCH                
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();                
        DECLARE @ErrorState INT = ERROR_STATE();                
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                
    END CATCH                
                
    -- Drop the temporary table                
    DROP TABLE #TempEmails;                
END; 
GO
/****** Object:  StoredProcedure [dbo].[AddEditContactForCustomer]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddEditContactForCustomer]  
@CustomerContactId INT,  
@CustomerId INT,          
@ContactId INT,          
@ContactTypeId SMALLINT,  
@IsPrimary BIT,      
@CreatedBy SMALLINT               
AS            
BEGIN            
 SET NOCOUNT ON;            
BEGIN TRY                          
   IF @CustomerContactId > 0  
   BEGIN  
         
        IF EXISTS (SELECT 1 FROM [dbo].[L_CustomerContacts]  WHERE CustomerContactId = @CustomerContactId         
        AND ( ContactTypeId != @ContactTypeId OR IsPrimary != @IsPrimary))             
       BEGIN   
           UPDATE [dbo].[L_CustomerContacts]  
           SET  
               ContactTypeId = @ContactTypeId,  
               IsPrimary = @IsPrimary  
           WHERE  
               CustomerContactId = @CustomerContactId  

            UPDATE [dbo].[Contacts] 
            SET  
                [UpdatedBy]=@CreatedBy,
                [UpdatedAt]=GETDATE()
            WHERE  
                ContactId = @ContactId   

           SELECT @CustomerContactId AS KeyValue,  
           'Customer contact updated' AS Message;  
      END        
    
   END  
   ELSE  
   BEGIN  
       -- Insert new contact  
       DECLARE @keyId AS INT;  
         
       INSERT INTO [dbo].[L_CustomerContacts]  
       (  
           CustomerId,  
           ContactId,  
           ContactTypeId,  
           IsPrimary,  
           StatusId,  
           CreatedBy,  
           CreatedAt  
       )            
       VALUES          
       (  
           @CustomerId,  
           @ContactId,  
           @ContactTypeId,  
           @IsPrimary,  
           1,  
           @CreatedBy,  
           GETDATE()  
       );  
         
       SET @keyId = SCOPE_IDENTITY();  
         
       SELECT @keyId AS KeyValue,  
       'Customer contact added' AS Message;  
   END  
END TRY                        
BEGIN CATCH                      
   DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();  
   DECLARE @ErrorSeverity INT = ERROR_SEVERITY();  
   DECLARE @ErrorState INT = ERROR_STATE();  
   RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);  
END CATCH;                      
END;  
GO
/****** Object:  StoredProcedure [dbo].[AddEditContactForSupplier]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddEditContactForSupplier]
@SupplierContactId INT,
@SupplierId INT,        
@ContactId INT,        
@ContactTypeId SMALLINT,
@IsPrimary BIT,    
@CreatedBy SMALLINT             
AS          
BEGIN          
 SET NOCOUNT ON;          
BEGIN TRY                        
   IF @SupplierContactId > 0
   BEGIN
       
        IF EXISTS (SELECT 1 FROM [dbo].[L_SupplierContacts] WHERE SupplierContactId = @SupplierContactId       
        AND ( ContactTypeId != @ContactTypeId OR IsPrimary != @IsPrimary))           
       BEGIN 
           UPDATE [dbo].[L_SupplierContacts]
           SET
               ContactTypeId = @ContactTypeId,
               IsPrimary = @IsPrimary
           WHERE
               SupplierContactId = @SupplierContactId

           SELECT @SupplierContactId AS KeyValue,
           'Supplier contact updated' AS Message;
      END      
  
   END
   ELSE
   BEGIN
       -- Insert new contact
       DECLARE @keyId AS INT;
       
       INSERT INTO [dbo].[L_SupplierContacts]
       (
           SupplierId,
           ContactId,
           ContactTypeId,
           IsPrimary,
           StatusId,
           CreatedBy,
           CreatedAt
       )          
       VALUES        
       (
           @SupplierId,
           @ContactId,
           @ContactTypeId,
           @IsPrimary,
           1,
           @CreatedBy,
           GETDATE()
       );
       
       SET @keyId = SCOPE_IDENTITY();
       
       SELECT @keyId AS KeyValue,
       'Supplier contact added' AS Message;
   END
END TRY                      
BEGIN CATCH                    
   DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();
   DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
   DECLARE @ErrorState INT = ERROR_STATE();
   RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
END CATCH;                    
END;
GO
/****** Object:  StoredProcedure [dbo].[AddEditContactPhone]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
            
          
          
CREATE PROCEDURE [dbo].[AddEditContactPhone]            
    @PhoneList dbo.PhoneTypeTable READONLY,            
    @ContactId INT            
AS            
BEGIN            
    SET NOCOUNT ON;            
            
    BEGIN TRY            
        -- Create a temporary table to hold the incoming data            
        CREATE TABLE #TempPhoneList (            
            PhoneId INT,            
            PhoneNumber VARCHAR(20),            
            PhoneCode VARCHAR(10),            
            PhoneTypeId SMALLINT,            
            Extension INT,  
            IsPrimary BIT,  
            OwnerTypeId TINYINT,    
            CreatedBy SMALLINT      
        );            
            
        -- Insert the incoming data into the temporary table            
        INSERT INTO #TempPhoneList (PhoneId, PhoneNumber, PhoneCode, PhoneTypeId, Extension,IsPrimary,OwnerTypeId,CreatedBy)            
        SELECT PhoneId, PhoneNumber, PhoneCode, PhoneTypeId, Extension,IsPrimary,OwnerTypeId,CreatedBy            
        FROM @PhoneList;            
            
        -- Update existing records            
        UPDATE p            
        SET p.PhoneNumber = t.PhoneNumber,            
            p.PhoneCode = t.PhoneCode,            
            p.PhoneTypeId = t.PhoneTypeId,            
            p.Extension = t.Extension,  
            p.IsPrimary=t.IsPrimary,            
            p.UpdatedAt = GETDATE(),            
            p.UpdatedBy = t.CreatedBy            
        FROM dbo.Phones p            
        INNER JOIN #TempPhoneList t ON p.PhoneId = t.PhoneId            
        WHERE p.OwnerId = @ContactId AND p.OwnerTypeId = t.OwnerTypeId AND DeletedAt IS NULL AND DeletedBy IS NULL    
        AND (p.PhoneNumber <> t.PhoneNumber OR p.PhoneCode <> t.PhoneCode OR p.PhoneTypeId <> t.PhoneTypeId OR p.Extension <> t.Extension OR p.IsPrimary <>t.IsPrimary);       
        -- Insert new records            
        INSERT INTO [dbo].[Phones] (PhoneNumber, PhoneCode, PhoneTypeId, Extension,IsPrimary ,OwnerId, OwnerTypeId, CreatedAt, CreatedBy)            
        SELECT t.PhoneNumber, t.PhoneCode, t.PhoneTypeId, t.Extension,t.IsPrimary, @ContactId, t.OwnerTypeId, GETDATE(), t.CreatedBy            
        FROM #TempPhoneList t            
        LEFT JOIN dbo.Phones p ON t.PhoneId = p.PhoneId            
        WHERE p.PhoneId IS NULL;            
            
        -- Drop the temporary table            
        DROP TABLE #TempPhoneList;            
    END TRY            
    BEGIN CATCH            
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();            
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();            
        DECLARE @ErrorState INT = ERROR_STATE();            
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);            
    END CATCH            
END; 
GO
/****** Object:  StoredProcedure [dbo].[AddEditCustomerSettings]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[AddEditCustomerSettings] 
    @CustomerAccountingSettingId INT=0,
	@CustomerId INT,
    @PaymentTermId TINYINT,
    @CreditLimit DECIMAL,
    @PaymentMethodId TINYINT,
    @InvoiceSubmissionInstruction NVARCHAR(1000),
    @BillingCurrency NVARCHAR(1000),
	@CreatedBy smallint
AS
BEGIN
    SET NOCOUNT ON;            
    BEGIN TRY                            
        DECLARE @keyId AS INT;

        IF @CustomerAccountingSettingId > 0
        BEGIN
            IF EXISTS (SELECT 1 FROM [dbo].[CustomerAccoutingSettings] WHERE CustomerAccountingSettingId = @CustomerAccountingSettingId)
            BEGIN
                UPDATE [dbo].[CustomerAccoutingSettings]
                SET
                    PaymentTermId = @PaymentTermId,
					CustomerId =@CustomerId,
                    CreditLimit = @CreditLimit,
                    PaymentMethodId = @PaymentMethodId,
                    InvoiceSubmissionInstruction = @InvoiceSubmissionInstruction,
                    BillingCurrency = @BillingCurrency,
					UpdatedBy = @CreatedBy,
                    UpdatedAt = GETDATE()
                WHERE
                    CustomerAccountingSettingId = @CustomerAccountingSettingId;
                
                SELECT @CustomerAccountingSettingId AS KeyValue,   
                'Customer Accouting Settings Updated' AS ErrorMessage;
            END
            ELSE
            BEGIN
                SELECT @CustomerAccountingSettingId AS KeyValue,   
                  'NO RECORD FOUND' AS ErrorMessage;
            END
        END
        ELSE
        BEGIN
            INSERT INTO [dbo].[CustomerAccoutingSettings]            
            (         
                PaymentTermId,    
				CustomerId,
                CreditLimit,
				PaymentMethodId,
                InvoiceSubmissionInstruction,
                BillingCurrency,
				CreatedBy,            
                CreatedAt     
            )            
            VALUES          
            (        
                @PaymentTermId,
				@CustomerId,
                @CreditLimit,
                @PaymentMethodId,
                @InvoiceSubmissionInstruction,
                @BillingCurrency,
				@CreatedBy,            
                 GETDATE()
            );            
            
            SET @keyId = SCOPE_IDENTITY();
			
			SELECT @keyId AS KeyValue,   
			'Customer Accouting Settings added' AS ErrorMessage;
        END

       
    END TRY                    
    BEGIN CATCH                      
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                      
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();                      
        DECLARE @ErrorState INT = ERROR_STATE();                      
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                      
    END CATCH;
END;
GO
/****** Object:  StoredProcedure [dbo].[AddEditSupplierBasicInformation]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddEditSupplierBasicInformation]    
    @SupplierId INT,                   
    @Name VARCHAR(150),    
    @DbaName VARCHAR(150),                    
    @GroupTypeId SMALLINT,                    
    @SupplierTypeId SMALLINT,                    
    @TerritoryId SMALLINT,                    
    @CountryId SMALLINT,                    
    @Website NVARCHAR(250),                      
    @TaxId VARCHAR(15),                
    @CreatedBy SMALLINT,      
    @Note VARCHAR(200),
    @EmailAddress VARCHAR(255) ,
	@ResponsibleUserId SMALLINT
AS                          
BEGIN                          
    SET NOCOUNT ON;                          
    BEGIN TRY                                    
        DECLARE @keyId AS INT;                            
            
        IF @SupplierId > 0     
        BEGIN         
            IF EXISTS (SELECT 1 FROM [dbo].[Suppliers] WHERE SupplierId = @SupplierId)    
            BEGIN    
                UPDATE [dbo].[Suppliers]    
                SET     
                    Name = @Name,    
                    DbaName=@DbaName,    
                    GroupTypeId = @GroupTypeId,    
                    SupplierTypeId = @SupplierTypeId,    
                    TerritoryId = @TerritoryId,    
                    CountryId = @CountryId,    
                    Website = @Website,    
                    TaxId = @TaxId,    
                    UpdatedAt = GETDATE(),    
                    UpdatedBy = @CreatedBy,
					ResponsibleUserId=@ResponsibleUserId
                WHERE SupplierId = @SupplierId;    
                    
                SET @keyId = @SupplierId;    
                    
                SELECT @keyId AS KeyValue,     
                    'Supplier Information Updated' AS ErrorMessage;    
                
                 UPDATE [dbo].[Emails]        
                 SET EmailAddress = @EmailAddress,        
                 UpdatedBy = @CreatedBy,        
                 UpdatedAt = GETDATE()        
                 WHERE OwnerId = @SupplierId AND OwnerTypeId = 2;    
                

                UPDATE [dbo].[SupplierNotes] SET    
                Note=@Note,     
                UpdatedBy=@CreatedBy,    
                UpdatedAt=GETDATE()                    
                WHERE SupplierId=@SupplierId    
            END    
        END    
        ELSE    
        BEGIN    
            BEGIN   
                IF EXISTS (SELECT 1 FROM [dbo].[Suppliers]   WHERE Name = @Name AND DeletedAt IS NULL AND DeletedBy IS NULL)                   
                BEGIN              
                 SELECT CAST(0 AS INT) as KeyValue,                                                  
                    'Supplier '+ @Name + ' already exists.' as ErrorMessage                   
                END              
                ELSE IF EXISTS (SELECT 1 FROM [dbo].[Suppliers] WHERE TaxId = @TaxId AND Name = @Name) OR   
                EXISTS (SELECT 1 FROM [dbo].[Suppliers] WHERE TaxId = @TaxId)                
                BEGIN             
                    SELECT CAST(0 AS INT) as KeyValue,                                  
                    'Suppliers with ' + @TaxId + '  already exists.' as ErrorMessage                
                END                
                  
                INSERT INTO [dbo].[Suppliers]                          
                (                    
                    Name,    
                    DbaName,                  
                    GroupTypeId,                    
                    SupplierTypeId,    
                    TerritoryId,                    
                    CountryId,                    
                    Website,                           
                    TaxId,                     
                    StatusId,             
                    CreatedAt,      
                    CreatedBy,
					ResponsibleUserId
                )                          
                VALUES                        
                (                    
                    @Name,    
                    @DbaName,                  
                    @GroupTypeId,                       
                    @SupplierTypeId,    
                    @TerritoryId,                    
                    @CountryId,                    
                    @Website,                       
                    @TaxId,                      
                  1,              
                    GETDATE(),      
                    @CreatedBy ,
					@ResponsibleUserId
                );                          
                          
                SET @keyId = SCOPE_IDENTITY();                                  
                          
                SELECT @keyId as KeyValue,                                   
                'Supplier Information Added' as ErrorMessage;                             
            END;              
                          
            IF @keyId > 0                    
            BEGIN  
                INSERT INTO [dbo].[Emails](EmailAddress,OwnerId,OwnerTypeId,CreatedBy,CreatedAt)                
                VALUES(@EmailAddress,@keyId,2,@CreatedBy,GETDATE())                    
                
                INSERT INTO [dbo].[SupplierNotes](Note, SupplierId, CreatedBy, CreatedAt)                    
                VALUES(@Note, @keyId, @CreatedBy, GETDATE());                    
            END;    
        END           
                          
    END TRY                                      
    BEGIN CATCH                                    
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                                    
        DECLARE @ErrorSeverity NVARCHAR(MAX) = ERROR_SEVERITY();                                    
        DECLARE @ErrorState NVARCHAR(MAX) = ERROR_STATE();                                    
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                                    
    END CATCH;                                    
END; 
GO
/****** Object:  StoredProcedure [dbo].[AddRoleMapping]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddRoleMapping]  
@UserId SMALLINT,
@RoleId tinyint,
@CreatedBy SMALLINT        
        
AS        
BEGIN        
 SET NOCOUNT ON;        
BEGIN TRY                  
IF EXISTS (SELECT UserRoleId FROM [dbo].[L_UserRoles] WHERE RoleId=@RoleId And UserId=@UserId And DeletedBy is null And DeletedAt is null )        
 BEGIN        
   SELECT CAST(0 AS SMALLINT) as KeyValue,                 
  'Role EXISTS' as ErrorMessage           
 END        
 ELSE        
 BEGIN         
 DECLARE @keyId AS SMALLINT          
        
   INSERT INTO [dbo].[L_UserRoles]        
  (  
  RoleId,
  UserId,
  CreatedBy,        
  CreatedAt       
  )        
  VALUES      
  (
   @RoleId,
   @UserId,
   @CreatedBy,        
   GETDATE()        
  )        
        
   SET  @keyId = SCOPE_IDENTITY()                
        
   SELECT @keyId as KeyValue,                 
   'User Role Added' as ErrorMessage           
 END        
        
END TRY                    
BEGIN CATCH                  
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                  
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                  
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                  
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                  
END CATCH                  
END 
GO
/****** Object:  StoredProcedure [dbo].[AddRoles]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddRoles]      
@RoleName VARCHAR(50),    
@CreatedBy SMALLINT      
      
AS      
BEGIN      
 SET NOCOUNT ON;      
BEGIN TRY                
IF EXISTS (SELECT RoleId FROM [dbo].[Roles] WHERE RoleName=@RoleName And DeletedBy is null And DeletedAt is null )      
 BEGIN      
   SELECT CAST(0 AS TINYINT) as KeyValue,               
  'RoleName EXISTS' as ErrorMessage         
 END      
 ELSE      
 BEGIN       
 DECLARE @keyId AS INT        
      
   INSERT INTO [dbo].[Roles]      
  (   
  RoleName,  
  CreatedBy,      
  CreatedAt     
  )      
  VALUES    
  (  
   @RoleName,  
   @CreatedBy,      
   GETDATE()      
  )      
      
   SET  @keyId = SCOPE_IDENTITY()              
      
   SELECT @keyId as KeyValue,               
   'Role Added' as ErrorMessage         
 END      
      
END TRY                  
BEGIN CATCH                
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
END CATCH                
END 
GO
/****** Object:  StoredProcedure [dbo].[AddSecurityPermissions]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================    
-- Author:  <SHRUTEN>    
-- Create date: <Create Date,,>    
-- Description: <Description,,>    
-- =============================================  
CREATE PROCEDURE [dbo].[AddSecurityPermissions]     
@SecurityPermissions [SecurityPermissionsType] READONLY,    
@UserId SMALLINT    
AS    
BEGIN    
 SET NOCOUNT ON;    
BEGIN TRY      
 Declare @TempTable TABLE (    
  SecuritySettingId TINYINT,    
  SecurityKeyId SMALLINT,    
  RoleId TINYINT,    
  SecurityPermissionId INT    
 );    
    
 INSERT INTO @TempTable(SecuritySettingId,SecurityKeyId,RoleId)     
 SELECT SecuritySettingId,SecurityKeyId,RoleId FROM @SecurityPermissions    
    
 UPDATE @TempTable SET     
 SecurityPermissionId = SP.SecurityPermissionId    
 FROM [dbo].[SecurityPermissions] SP    
 INNER JOIN @TempTable T ON T.SecurityKeyId = SP.SecurityKeyId AND T.RoleId = SP.RoleId  
    
 UPDATE [dbo].[SecurityPermissions]    
 SET     
 SecuritySettingId = T.SecuritySettingId,    
 SecurityKeyId = T.SecurityKeyId,    
 RoleId = T.RoleId,    
 UpdatedBy = @UserId,    
 UpdatedAt = GETDATE()    
 FROM @TempTable T    
 INNER JOIN [SecurityPermissions] SP ON T.SecurityPermissionId = SP.SecurityPermissionId    
    
 INSERT INTO [dbo].[SecurityPermissions](SecuritySettingId,SecurityKeyId,RoleId,CreatedBy,CreatedAt)     
 SELECT SecuritySettingId,SecurityKeyId,RoleId,@UserId,GETDATE() FROM @TempTable WHERE SecurityPermissionID IS NULL     
    
 SELECT cast(1 as bit) as KeyValue             
    
END TRY                
BEGIN CATCH              
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()              
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()              
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()              
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)              
END CATCH      
END 
GO
/****** Object:  StoredProcedure [dbo].[AddShppingDeliveryCarriers]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddShppingDeliveryCarriers]        
@CustomerId INT,
@CarrierId SMALLINT,
@AccountNumber VARCHAR(50),
@IsPrimary BIT,      
@CreatedBy SMALLINT                
AS        
BEGIN        
 SET NOCOUNT ON; 
 DECLARE @keyId AS INT                 

BEGIN TRY                  
    IF EXISTS (SELECT CarrierId FROM [dbo].[L_CustomerDeliveryCarriers] WHERE CarrierId=@CarrierId AND CustomerId=@CustomerId And DeletedBy is null And DeletedAt is null )        
    BEGIN        
        SELECT CAST(0 AS TINYINT) as KeyValue,                 
        'Carriers EXISTS' as ErrorMessage           
    END        
    ELSE        
    BEGIN
        IF @IsPrimary =1  
        BEGIN  
            UPDATE [dbo].[L_CustomerDeliveryCarriers] SET  
            IsPrimary=0  
            WHERE CustomerId =@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL  
        END
 
        INSERT INTO [dbo].[L_CustomerDeliveryCarriers]        
        (     
            CarrierId,
            AccountNumber,
            CustomerId,
            IsPrimary,    
            CreatedBy,        
            CreatedAt       
        )        
        VALUES      
        (    
            @CarrierId,
            @AccountNumber,
            @CustomerId,
            @IsPrimary,    
            @CreatedBy,        
            GETDATE()        
        )        
        
        SET  @keyId = SCOPE_IDENTITY()                
        
        SELECT @keyId as KeyValue,                 
        'Carriers Added' as ErrorMessage           
    END        
        
END TRY                    
BEGIN CATCH                  
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                  
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                  
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                  
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                  
END CATCH                  
END 
GO
/****** Object:  StoredProcedure [dbo].[AddSupplierDocuments]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddSupplierDocuments] 
@Name VARCHAR(75),                        
@DocumentTypeId TINYINT,                        
@SupplierId INT,                        
@Attachment NVARCHAR(255),                   
@CreatedBy SMALLINT                              
                              
AS                              
BEGIN                              
 SET NOCOUNT ON;                              
BEGIN TRY                                        
    DECLARE @keyId AS INT                                
                   
                
        IF EXISTS (SELECT 1 FROM [dbo].[SupplierDocuments] WHERE DocumentTypeId = @DocumentTypeId and SupplierId=@SupplierId AND DeletedAt IS NULL AND DeletedBy IS NULL)                         
            BEGIN                    
                SELECT CAST(0 AS INT) as KeyValue,                                                        
                'Document exists on this type, Only one document per type' as ErrorMessage                           
            END         
        ELSE IF EXISTS (SELECT 1 FROM [dbo].[SupplierDocuments] WHERE Name = @Name AND SupplierId=@SupplierId)                    
             BEGIN                 
                SELECT CAST(0 AS INT) as KeyValue,                                      
                'Document name already exists' as ErrorMessage                          
              END                   
       ELSE                  
            BEGIN                  
                INSERT INTO [dbo].[SupplierDocuments]                             
                (                        
                    Name,          
                    DocumentTypeId,          
                    SupplierId,          
                    Attachment,          
                    StatusId,                      
                    CreatedBy,                              
                    CreatedAt                             
                )                              
                VALUES                            
                (                        
                    @Name,          
                    @DocumentTypeId,          
                    @SupplierId,          
                    @Attachment,            
                    1,                
                    @CreatedBy,                              
                    GETDATE()                              
                )                              
                              
                SET  @keyId = SCOPE_IDENTITY()                                      
                              
                SELECT @keyId as KeyValue,                                       
                'Document Added' as ErrorMessage                                 
            END                  
                              
END TRY                                          
BEGIN CATCH                                        
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                                        
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                                        
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                                        
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                                        
END CATCH                                        
END 	 
GO
/****** Object:  StoredProcedure [dbo].[AddSupplierNotes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddSupplierNotes] 
	-- Add the parameters for the stored procedure here
	 @SupplierId int,	
	@Note nvarchar(1000),
	 @CreatedBy smallint
AS
BEGIN

	SET NOCOUNT ON;
	BEGIN TRY                
		IF EXISTS (SELECT SupplierNoteId FROM [dbo].[SupplierNotes] WHERE Note=@Note )      
			BEGIN      
			   SELECT CAST(0 AS SMALLINT) as KeyValue,               
			  'Note EXISTS ' as ErrorMessage         
			END      
		ELSE      
		BEGIN       
		 DECLARE @keyId AS BIGINT        
      
		   INSERT INTO [dbo].[SupplierNotes]      
			  (
			   SupplierId,
			   Note,
			   CreatedBy,
				CreatedAt
			  )      
			  VALUES    
			  (
				@SupplierId,
				@Note ,
				@CreatedBy, 
				GETDATE()
			  )      
		   SET  @keyId = SCOPE_IDENTITY()              
		   SELECT @keyId as KeyValue,               
		   'Note Added' as ErrorMessage         
		END      
      
	END TRY                  
	BEGIN CATCH                
	 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
	 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                
	 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                
	 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
	END CATCH   
   
END

GO
/****** Object:  StoredProcedure [dbo].[AddUserCheckListResponse]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================  
-- Author:  <Author,,Name>  
-- Create date: <Create Date,,>  
-- Description: <Description,,>  
-- =============================================  
CREATE PROCEDURE [dbo].[AddUserCheckListResponse]  
	@CheckListResponse CheckListResponseTypeTable READONLY
AS  
BEGIN  
 -- SET NOCOUNT ON added to prevent extra result sets from  
 -- interfering with SELECT statements.  
 SET NOCOUNT ON;  
 BEGIN         
   DECLARE @keyId AS BIGINT          
        
     INSERT INTO [dbo]. UserChecklistResponses        
     (  
		UserId,  
		IsApproved,  
		ChecklistItemId,
		CreatedAt  
     )        
      SELECT  
            UserId,  
            IsApproved,  
            ChecklistItemId,  
            GETDATE()        
        FROM @CheckListResponse;      
	
     SET  @keyId = SCOPE_IDENTITY()                
     SELECT @keyId as KeyValue,                 
     'Response Added' as ErrorMessage           
  END        
       
END  
GO
/****** Object:  StoredProcedure [dbo].[AddUsers]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AddUsers]
@FirstName VARCHAR(200),
@LastName VARCHAR(200),
@UserName VARCHAR(200),    
@HashedPassword NVARCHAR(64),    
@PasswordSalt NVARCHAR (32),      
@IsActive BIT,      
@CreatedBy SMALLINT      
      
AS      
BEGIN      
 SET NOCOUNT ON;      
BEGIN TRY                
IF EXISTS (SELECT UserID FROM [dbo].[Users] WHERE UserName=@UserName And DeletedBy is null And DeletedAt is null )      
 BEGIN      
   SELECT CAST(0 AS SMALLINT) as KeyValue,               
  'UserName EXISTS' as ErrorMessage         
 END      
 ELSE      
 BEGIN       
 DECLARE @keyId AS SMALLINT        
      
   INSERT INTO [dbo].[Users]      
  (
  FirstName,
  LastName,
  UserName,      
  HashedPassword,      
  PasswordSalt,      
  IsActive,      
  CreatedBy,      
  CreatedAt     
  )      
  VALUES    
  (
   @FirstName,
   @LastName,
   @UserName,      
   @HashedPassword,    
   @PasswordSalt,    
   @IsActive,      
   @CreatedBy,      
   GETDATE()      
  )      
      
   SET  @keyId = SCOPE_IDENTITY()              
      
   SELECT @keyId as KeyValue,               
   'User Added' as ErrorMessage         
 END      
      
END TRY                  
BEGIN CATCH                
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
END CATCH                
END 
GO
/****** Object:  StoredProcedure [dbo].[CheckCustomerNameExist]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[CheckCustomerNameExist]      
@Name VARCHAR(100)

AS      
BEGIN      
    SET NOCOUNT ON;

    BEGIN TRY                
        IF EXISTS (SELECT CustomerId FROM [dbo].[Customers] WHERE Name = @Name AND DeletedBy IS NULL AND DeletedAt IS NULL)
        BEGIN      
            SELECT CAST(0 AS INT) AS KeyValue,               
            'Customer name already exists' AS ErrorMessage;         
        END      
        ELSE      
        BEGIN
            SELECT CAST(1 AS INT) AS KeyValue,               
            'Customer name does not exist' AS ErrorMessage;         
        END
    END TRY                  
    BEGIN CATCH                
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();                
        DECLARE @ErrorState INT = ERROR_STATE();                
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                
    END CATCH;                
END;
GO
/****** Object:  StoredProcedure [dbo].[CheckDocumentsExistOrNot]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CheckDocumentsExistOrNot]
    @DocumentTypeId INT,
    @CustomerId INT,
    @Name NVARCHAR(255)
AS
BEGIN
    SET NOCOUNT ON;

    -- Check if a document of the specified type exists for the customer
    IF EXISTS (SELECT 1 FROM [dbo].[CustomerDocuments] WHERE DocumentTypeId = @DocumentTypeId AND CustomerId = @CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL)
    BEGIN
        SELECT CAST(0 AS INT) AS KeyValue,
        'Document exists on this type, Only one document per type' AS ErrorMessage;
        RETURN;
    END

    -- Check if a document with the specified name exists for the customer
    IF EXISTS (SELECT 1 FROM [dbo].[CustomerDocuments] WHERE Name = @Name AND CustomerId = @CustomerId)
    BEGIN
        SELECT CAST(0 AS INT) AS KeyValue,
        'Document name already exists' AS ErrorMessage;
        RETURN;
    END

    -- If neither check returns true, document does not exist
    SELECT CAST(1 AS INT) AS KeyValue,
    'Document does not exist' AS ErrorMessage;
END
GO
/****** Object:  StoredProcedure [dbo].[CheckSupplierNameExist]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[CheckSupplierNameExist]      
@Name VARCHAR(150)

AS      
BEGIN      
    SET NOCOUNT ON;

    BEGIN TRY  
	
        IF EXISTS (SELECT SupplierId FROM [dbo].[Suppliers] WHERE Name = @Name AND DeletedBy IS NULL AND DeletedAt IS NULL)
        BEGIN      
            SELECT CAST(0 AS INT) AS KeyValue,               
            'Supplier name already exists' AS ErrorMessage;         
        END      
        ELSE      
        BEGIN
            SELECT CAST(1 AS INT) AS KeyValue,               
            'Supplier name does not exist' AS ErrorMessage;         
        END
    END TRY                  
    BEGIN CATCH                
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();                
        DECLARE @ErrorState INT = ERROR_STATE();                
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                
    END CATCH;                
END;
GO
/****** Object:  StoredProcedure [dbo].[DeleteContactEmail]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
  
--DeleteContactEmail 1,1  
CREATE PROCEDURE [dbo].[DeleteContactEmail]  
 @EmailId INT,  
 @DeletedBy SMALLINT  
AS  
BEGIN  
    SET NOCOUNT ON;  
  
    BEGIN TRY  
        IF EXISTS (SELECT EmailId FROM [dbo].[Emails] WHERE EmailId= @EmailId)  
        BEGIN  
            UPDATE [dbo].[Emails]  
            SET  
                [DeletedBy] = @DeletedBy,  
                [DeletedAt] = GETDATE()  
            WHERE EmailId = @EmailId
  
            SELECT @EmailId AS KeyValue,  
            'Email Deleted' AS ErrorMessage;  
        END  
        ELSE  
        BEGIN  
            SELECT @EmailId AS KeyValue,  
            'No Record Found' AS ErrorMessage;  
        END  
    END TRY  
    BEGIN CATCH  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();  
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();  
        DECLARE @ErrorState INT = ERROR_STATE();  
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);  
    END CATCH  
END;  
GO
/****** Object:  StoredProcedure [dbo].[DeleteContactPhone]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
  
--DeleteContactPhone 1,1  
CREATE PROCEDURE [dbo].[DeleteContactPhone]  
 @PhoneId INT,  
 @DeletedBy SMALLINT  
AS  
BEGIN  
    SET NOCOUNT ON;  
  
    BEGIN TRY  
        IF EXISTS (SELECT PhoneId FROM [dbo].[Phones] WHERE PhoneId= @PhoneId)  
        BEGIN  
            UPDATE [dbo].[Phones]  
            SET  
                [DeletedBy] = @DeletedBy,  
                [DeletedAt] = GETDATE()  
            WHERE PhoneId = @PhoneId
  
            SELECT @PhoneId AS KeyValue,  
            'Phone Number Deleted' AS ErrorMessage;  
        END  
        ELSE  
        BEGIN  
            SELECT @PhoneId AS KeyValue,  
            'No Record Found' AS ErrorMessage;  
        END  
    END TRY  
    BEGIN CATCH  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();  
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();  
        DECLARE @ErrorState INT = ERROR_STATE();  
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);  
    END CATCH  
END;  
GO
/****** Object:  StoredProcedure [dbo].[DeleteCustomerDeliveryCarriersById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
  
--DeleteContactPhone 1,1  
CREATE PROCEDURE [dbo].[DeleteCustomerDeliveryCarriersById]  
 @CustomerDeliveryCarrierId INT,  
 @DeletedBy SMALLINT  
AS  
BEGIN  
    SET NOCOUNT ON;  
  
    BEGIN TRY  
        IF EXISTS (SELECT CustomerDeliveryCarrierId FROM [dbo].[L_CustomerDeliveryCarriers] WHERE CustomerDeliveryCarrierId= @CustomerDeliveryCarrierId)  
        BEGIN  
            UPDATE [dbo].[L_CustomerDeliveryCarriers] 
            SET  
                [DeletedBy] = @DeletedBy,  
                [DeletedAt] = GETDATE()  
            WHERE CustomerDeliveryCarrierId = @CustomerDeliveryCarrierId
  
            SELECT @CustomerDeliveryCarrierId AS KeyValue,  
            'Customer Delivery Deleted' AS ErrorMessage;  
        END  
        ELSE  
        BEGIN  
            SELECT @CustomerDeliveryCarrierId AS KeyValue,  
            'No Record Found' AS ErrorMessage;  
        END  
    END TRY  
    BEGIN CATCH  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();  
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();  
        DECLARE @ErrorState INT = ERROR_STATE();  
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);  
    END CATCH  
END;  
GO
/****** Object:  StoredProcedure [dbo].[DeleteCustomerDeliveryMethodsById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
  
--  
CREATE PROCEDURE [dbo].[DeleteCustomerDeliveryMethodsById]  
 @CustomerDeliveryMethodId INT,  
 @DeletedBy SMALLINT  
AS  
BEGIN  
    SET NOCOUNT ON;  
  
    BEGIN TRY  
        IF EXISTS (SELECT CustomerDeliveryMethodId FROM [dbo].[L_CustomCharge_CustomerDeliveryMethods] WHERE CustomerDeliveryMethodId= @CustomerDeliveryMethodId)  
        BEGIN  
            UPDATE [dbo].[L_CustomCharge_CustomerDeliveryMethods]
            SET  
                [DeletedBy] = @DeletedBy,  
                [DeletedAt] = GETDATE()  
            WHERE CustomerDeliveryMethodId = @CustomerDeliveryMethodId
  
            SELECT @CustomerDeliveryMethodId AS KeyValue,  
            'Customer Delivery Method Deleted' AS ErrorMessage;  
        END  
        ELSE  
        BEGIN  
            SELECT @CustomerDeliveryMethodId AS KeyValue,  
            'No Record Found' AS ErrorMessage;  
        END  
    END TRY  
    BEGIN CATCH  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();  
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();  
        DECLARE @ErrorState INT = ERROR_STATE();  
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);  
    END CATCH  
END;  
GO
/****** Object:  StoredProcedure [dbo].[DeleteCustomerDocumentsById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
    
--DeleteCustomerDocumentsById 1,1    
CREATE PROCEDURE [dbo].[DeleteCustomerDocumentsById]    
 @CustomerDocumentId INT,    
 @DeletedBy SMALLINT    
AS    
BEGIN    
    SET NOCOUNT ON;    
    
    BEGIN TRY    
        IF EXISTS (SELECT CustomerDocumentId FROM [dbo].[CustomerDocuments] WHERE CustomerDocumentId= @CustomerDocumentId)    
        BEGIN    
            UPDATE [dbo].[CustomerDocuments]    
            SET    
                [DeletedBy] = @DeletedBy,    
                [DeletedAt] = GETDATE()    
            WHERE CustomerDocumentId = @CustomerDocumentId  
    
            SELECT @CustomerDocumentId AS KeyValue,    
            'Document Deleted' AS ErrorMessage;    
        END    
        ELSE    
        BEGIN    
            SELECT @CustomerDocumentId AS KeyValue,    
            'No Record Found' AS ErrorMessage;    
        END    
    END TRY    
    BEGIN CATCH    
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();    
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();    
        DECLARE @ErrorState INT = ERROR_STATE();    
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);    
    END CATCH    
END; 
GO
/****** Object:  StoredProcedure [dbo].[DeleteRoles]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
  
--DeleteRoles 2,2  
CREATE PROCEDURE [dbo].[DeleteRoles]  
 @RoleId SMALLINT,  
 @DeletedBy SMALLINT  
AS  
BEGIN  
    SET NOCOUNT ON;  
  
    BEGIN TRY  
        IF EXISTS (SELECT RoleId FROM [dbo].[Roles] WHERE RoleId= @RoleId)  
        BEGIN  
            UPDATE [dbo].[Roles]  
            SET  
                [DeletedBy] = @DeletedBy,  
                [DeletedAt] = GETDATE()  
            WHERE RoleId = @RoleId
  
            SELECT @RoleId AS KeyValue,  
                   'Role Deleted' AS ErrorMessage;  
        END  
        ELSE  
        BEGIN  
            SELECT @RoleId AS KeyValue,  
                   'No Record Found' AS ErrorMessage;  
        END  
    END TRY  
    BEGIN CATCH  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();  
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();  
        DECLARE @ErrorState INT = ERROR_STATE();  
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);  
    END CATCH  
END;  
GO
/****** Object:  StoredProcedure [dbo].[DeleteRolesMapping]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
    
--DeleteRolesMapping 5,3    
CREATE PROCEDURE [dbo].[DeleteRolesMapping]    
 @UserRoleId SMALLINT,    
 @DeletedBy SMALLINT    
AS    
BEGIN    
    SET NOCOUNT ON;    
    
    BEGIN TRY    
        IF EXISTS (SELECT UserRoleId FROM [dbo].[L_UserRoles] WHERE UserRoleId= @UserRoleId)    
        BEGIN    
            UPDATE [dbo].[L_UserRoles]    
            SET    
                [DeletedBy] = @DeletedBy,    
                [DeletedAt] = GETDATE()    
            WHERE UserRoleId=@UserRoleId  
    
            SELECT @UserRoleId AS KeyValue,    
                   'Role Mapping Deleted' AS ErrorMessage;    
        END    
        ELSE    
        BEGIN    
            SELECT @UserRoleId AS KeyValue,    
                   'No Record Found' AS ErrorMessage;    
        END    
    END TRY    
    BEGIN CATCH    
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();    
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();    
        DECLARE @ErrorState INT = ERROR_STATE();    
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);    
    END CATCH    
END; 
GO
/****** Object:  StoredProcedure [dbo].[DeleteSupplierDocuementById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DeleteSupplierDocuementById] 
@SupplierDocumentId INT,    
 @DeletedBy SMALLINT    
AS    
BEGIN    
    SET NOCOUNT ON;    
    
    BEGIN TRY    
        IF EXISTS (SELECT SupplierDocumentId FROM [dbo].[SupplierDocuments] WHERE SupplierDocumentId= @SupplierDocumentId)    
        BEGIN    
            UPDATE [dbo].[SupplierDocuments]    
            SET    
                [DeletedBy] = @DeletedBy,    
                [DeletedAt] = GETDATE()    
            WHERE SupplierDocumentId = @SupplierDocumentId 
    
            SELECT @SupplierDocumentId AS KeyValue,    
            'Document Deleted' AS ErrorMessage;    
        END    
        ELSE    
        BEGIN    
            SELECT @SupplierDocumentId AS KeyValue,    
            'No Record Found' AS ErrorMessage;    
        END    
    END TRY    
    BEGIN CATCH    
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();    
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();    
        DECLARE @ErrorState INT = ERROR_STATE();    
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);    
    END CATCH    
END; 	 
GO
/****** Object:  StoredProcedure [dbo].[DeleteUser]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--DeleteUser 2,2
CREATE PROCEDURE [dbo].[DeleteUser]
 @UserId SMALLINT,
 @DeletedBy SMALLINT
AS
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        IF EXISTS (SELECT UserId FROM [dbo].[Users] WHERE UserId = @UserId )
        BEGIN
            UPDATE [dbo].[Users]
            SET
                [DeletedBy] = @DeletedBy,
                [DeletedAt] = GETDATE()
            WHERE UserId = @UserId 

            SELECT @UserId AS KeyValue,
                   'User Deleted' AS ErrorMessage;
        END
        ELSE
        BEGIN
            SELECT @UserId AS KeyValue,
                   'No Record Found' AS ErrorMessage;
        END
    END TRY
    BEGIN CATCH
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END;
GO
/****** Object:  StoredProcedure [dbo].[GetAddresssByCustomerId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
        
--GetAddresssByCustomerId 1076        
CREATE PROCEDURE [dbo].[GetAddresssByCustomerId]          
@CustomerId int           
AS          
BEGIN          
 SET NOCOUNT ON;          
     
 BEGIN TRY          
    SELECT
        CA.CustomerAddressId,      
        A.[AddressId],      
        ATS.[AddressTypeId],      
        ATS.[Type],      
        A.[AddressLine1],      
        A.[AddressLine2],      
        A.[AddressLine3],      
        A.[AddressLine4],      
        A.[AddressLine5],      
        A.[CountryId],      
        C.[Name] As CountryName,      
        A.[StateId],      
        S.[Name] As StateName,      
        A.[CityId],      
        CI.[Name] As CityName,      
        A.[ZipCode],  
        CA.IsPreferredShipping,  
        CA.IsPreferredBilling      
    FROM [dbo].[L_CustomerAddresses] CA          
    left JOIN [dbo].[AddressTypes] ATS ON ATS.AddressTypeId = CA.AddressTypeId      
    left JOIN [dbo].[Addresses] A ON A.AddressId = CA.AddressId      
    left JOIN [dbo].[Countries] C ON C.CountryId = A.CountryId      
    left JOIN [dbo].[States] S ON S.StateId= A.StateId      
    left JOIN [dbo].[Cities] CI ON CI.CityId = A.CityId      
    WHERE  CA.CustomerId=@CustomerId AND A.DeletedBy IS NULL AND A.DeletedAt IS NULL      
    ORDER BY A.AddressId DESC      
    
END TRY    
    BEGIN CATCH        
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()        
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()        
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()        
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)        
    END CATCH     
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAddresssBySupplierId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
        
--GetAddresssBySupplierId 5        
CREATE PROCEDURE [dbo].[GetAddresssBySupplierId]          
@SupplierId int           
AS          
BEGIN          
 SET NOCOUNT ON;          
     
 BEGIN TRY          
    SELECT
        SA.SupplierAddressId,      
        A.[AddressId],      
        SA.[AddressTypeId],      
        ATS.[Type],      
        A.[AddressLine1],      
        A.[AddressLine2],      
        A.[AddressLine3],      
        A.[AddressLine4],      
        A.[AddressLine5],      
        A.[CountryId],      
        C.[Name] As CountryName,      
        A.[StateId],      
        S.[Name] As StateName,      
        A.[CityId],      
        CI.[Name] As CityName,      
        A.[ZipCode],  
        SP.SupplierTypeId,  
        ST.Type As SupplierType      
    FROM [dbo].[L_SupplierAddresses] SA  
    left JOIN [dbo].[Suppliers] SP ON SP.SupplierId= SA.SupplierId  
    left JOIN [dbo].[AddressTypes] ATS ON ATS.AddressTypeId = SA.AddressTypeId   
    left JOIN [dbo].[SupplierTypes] ST ON ST.SupplierTypeId= SP.SupplierTypeId         
    left JOIN [dbo].[Addresses] A ON A.AddressId = SA.AddressId      
    left JOIN [dbo].[Countries] C ON C.CountryId = A.CountryId      
    left JOIN [dbo].[States] S ON S.StateId= A.StateId      
    left JOIN [dbo].[Cities] CI ON CI.CityId = A.CityId      
    WHERE  SA.SupplierId=@SupplierId AND A.DeletedBy IS NULL AND A.DeletedAt IS NULL      
    ORDER BY A.AddressId DESC      
    
END TRY    
    BEGIN CATCH        
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()        
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()        
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()        
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)        
    END CATCH     
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllAddressTypes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllAddressTypes       
CREATE PROCEDURE [dbo].[GetAllAddressTypes]                  
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT                  
[AddressTypeId],
[Type]
FROM [dbo].[AddressTypes]
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllCities]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllCities       
CREATE PROCEDURE [dbo].[GetAllCities]                  
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT                  
[CityId],
[Name],
[StateId]
FROM [dbo].[Cities]
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllContactTypes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllContactTypes       
CREATE PROCEDURE [dbo].[GetAllContactTypes]                  
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT                  
[ContactTypeId],
[Type]
FROM [dbo].[ContactTypes]
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllCountries]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
        
-- GetAllCountries         
CREATE PROCEDURE [dbo].[GetAllCountries]                    
                   
AS                    
BEGIN                    
 SET NOCOUNT ON;                    
BEGIN TRY                            
          
SELECT                    
[CountryId],  
[Name],
[PhoneCode]
FROM [dbo].[Countries]  
                                      
END TRY                            
BEGIN CATCH                            
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                            
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                            
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                            
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                            
END CATCH                     
                    
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllDeliveryAccounts]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
        
-- GetAllDeliveryAccounts         
CREATE PROCEDURE [dbo].[GetAllDeliveryAccounts]                    
AS                    
BEGIN                    
    SET NOCOUNT ON;                    
    BEGIN TRY                            
          
    SELECT                    
        [DeliveryAccountId],  
        [Name]
    FROM  [dbo].[DeliveryAccounts]  
  
END TRY                            
BEGIN CATCH                            
    DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                            
    DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                            
    DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                            
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                            
END CATCH                     
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllDeliveryCarriers]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllDeliveryCarriers       
CREATE PROCEDURE [dbo].[GetAllDeliveryCarriers]                  
AS                  
BEGIN                  
    SET NOCOUNT ON;                  
    BEGIN TRY                          
        
    SELECT                  
    [CarrierId],
    [Carrier]       
    FROM  [dbo].[DeliveryCarriers]    

END TRY                          
BEGIN CATCH                          
    DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
    DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
    DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllDeliveryMethods]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllDeliveryMethods       
CREATE PROCEDURE [dbo].[GetAllDeliveryMethods]                  
AS                  
BEGIN                  
    SET NOCOUNT ON;                  
    BEGIN TRY                          
        
    SELECT                  
        [DeliveryMethodId],
        [Name],
        [IsForInternational]  
    FROM  [dbo].[DeliveryMethods]

END TRY                          
BEGIN CATCH                          
    DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
    DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
    DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllDocumentTypes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllDocumentTypes       
CREATE PROCEDURE [dbo].[GetAllDocumentTypes]                  
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT
[DocumentTypeId],
[Type]
FROM  [dbo].[DocumentTypes]
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllGroupTypes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllGroupTypes       
CREATE PROCEDURE [dbo].[GetAllGroupTypes]                  
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT                  
 [GroupTypeId],    
 [Type]
FROM  [dbo].[GroupTypes]
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllPagesByRoleId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- GetAllPagesByRoleId 24
CREATE PROCEDURE [dbo].[GetAllPagesByRoleId]    
 @RoleId TINYINT = 0    
AS    
BEGIN    
    
 SELECT     
  sk.SecurityKeyId,    
  isnull(sk.SecurityKeyParentId,0) as SecurityKeyParentId,    
  SecurityKeyName,    
  isnull(IsMenu,0) as IsMenu,    
  sp.SecurityPermissionId,    
  isnull(sp.SecuritySettingId, 5) as SecuritySettingId,    
  ss.SecuritySettingName,    
  @RoleId as RoleId,    
  GrantDenyFlag,  
  DisplayOrder    
 FROM [dbo].[SecurityKey] sk     
 LEFT JOIN [dbo].[SecurityPermissions] sp on sk.SecurityKeyId = sp.SecurityKeyId AND RoleId = @RoleId    
 LEFT JOIN [dbo].[SecuritySettings] ss on ss.SecuritySettingId = sp.SecuritySettingId    
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllPaymentMethod]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
create PROCEDURE [dbo].[GetAllPaymentMethod] 
	 
AS
 
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT                  
 PaymentMethodId,
 Method
FROM [dbo].PaymentMethods
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllPhoneTypes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllPhoneTypes       
CREATE PROCEDURE [dbo].[GetAllPhoneTypes]                  
AS                  
BEGIN                  
    SET NOCOUNT ON;                  
    BEGIN TRY                          
        
    SELECT                  
        [PhoneTypeId],
        [Type]
    FROM  [dbo].[PhoneTypes]

END TRY                          
BEGIN CATCH                          
    DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
    DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
    DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllResponseuser]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetAllResponseuser]
	
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT
	UserId,
	UserName
 from Users;
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllRoles]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
    
-- GetAllRoles     
CREATE PROCEDURE [dbo].[GetAllRoles]                
               
AS                
BEGIN                
 SET NOCOUNT ON;                
BEGIN TRY                        
      
SELECT                
	[RoleId] ,  
	[RoleName]       
FROM  [dbo].[Roles]  
WHERE DeletedAt IS NULL AND DeletedBy IS NULL
                                  
END TRY                        
BEGIN CATCH                        
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                        
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                        
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                        
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                        
END CATCH                 
                
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllStates]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllStates       
CREATE PROCEDURE [dbo].[GetAllStates]                  
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT                  
[StateId],
[Name],
[CountryId]
FROM [dbo].[States]
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllSupplierType]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- GetAllSupplierType         
CREATE PROCEDURE [dbo].[GetAllSupplierType]                    
                   
AS                    
BEGIN                    
 SET NOCOUNT ON;                    
BEGIN TRY                            
          
SELECT                    
[SupplierTypeId],  
[Type]  
FROM [dbo].[SupplierTypes]  
                                      
END TRY                            
BEGIN CATCH                            
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                            
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                            
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                            
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                            
END CATCH                     
                    
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllTerritories]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
-- GetAllTerritories       
CREATE PROCEDURE [dbo].[GetAllTerritories]                  
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT                  
 [TerritoryId],    
 [Territory]
FROM [dbo].[Territories]
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetAllUser]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetAllUser]
	
                 
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT
	UserId,
	CONCAT(FirstName, ' ', LastName) AS FullName
 from Users 
      WHERE DeletedAt IS NULL AND DeletedBy IS NULL And IsActive=1;
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetCheckListItemByListId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- GetCheckListItemByListId 1
CREATE PROCEDURE [dbo].[GetCheckListItemByListId]  
    @ChecklistId int  
AS  
BEGIN  
    SET NOCOUNT ON;  
    BEGIN TRY  
        SELECT    
            CLI.[ChecklistItemId],    
            CLI.[ItemDescription],
			CLI.[ChecklistId]
			
        FROM [dbo].[ChecklistItems] CLI
        WHERE CLI.ChecklistId = @ChecklistId  
    END TRY      
    BEGIN CATCH          
        DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()          
        DECLARE @ErrorSeverity int = ERROR_SEVERITY()          
        DECLARE @ErrorState int = ERROR_STATE()          
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)          
    END CATCH       
END  
GO
/****** Object:  StoredProcedure [dbo].[GetContactByCustomerId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
  
-- GetContactByCustomerId 1076  
CREATE PROCEDURE [dbo].[GetContactByCustomerId]                    
@CustomerId int                     
AS                    
BEGIN                    
    SET NOCOUNT ON;  
      
    BEGIN TRY                     
        SELECT        
            LCC.CustomerContactId,                
            LCC.[CustomerId],            
            LCC.ContactId,            
            LCC.ContactTypeId,            
            CT.Type,            
            CON.FirstName,            
            CON.LastName,          
            ISNULL((  
                SELECT STUFF((  
                    SELECT DISTINCT ',' + ISNULL(E.EmailAddress, '')  
                    FROM [dbo].[Emails] E  
                    WHERE E.OwnerId = CON.ContactId AND E.OwnerTypeId = 3  
                      AND E.DeletedBy IS NULL AND E.DeletedAt IS NULL  
                    FOR XML PATH(''), TYPE  
                ).value('text()[1]', 'nvarchar(max)'), 1, 1, '')  
            ), '') AS EmailAddress,  
            ISNULL((  
                SELECT STUFF((  
                    SELECT DISTINCT ',' + ISNULL(P.PhoneNumber, '')  
                    FROM [dbo].[Phones] P  
                    WHERE P.OwnerId = CON.ContactId AND P.OwnerTypeId = 3  
                      AND P.DeletedBy IS NULL AND P.DeletedAt IS NULL  
                    FOR XML PATH(''), TYPE  
                ).value('text()[1]', 'nvarchar(max)'), 1, 1, '')  
            ), '') AS PhoneNumber,
			CC.IsPrimary
        FROM   
            [dbo].[L_CustomerContacts] LCC            
            LEFT JOIN [dbo].[Contacts] CON ON LCC.ContactId = CON.ContactId            
            LEFT JOIN [dbo].[ContactTypes] CT ON LCC.ContactTypeId = CT.ContactTypeId
			LEFT JOIN [dbo].[L_CustomerContacts] CC ON CC.ContactId = CON.ContactId
            --LEFT JOIN [dbo].[Emails] E ON CON.ContactId = E.OwnerId AND E.OwnerTypeId = 3 AND E.DeletedBy IS NULL AND E.DeletedAt IS NULL  
            --LEFT JOIN [dbo].[Phones] P ON CON.ContactId = P.OwnerId AND P.OwnerTypeId = 3 AND P.DeletedBy IS NULL AND P.DeletedAt IS NULL  
        WHERE    
            LCC.CustomerId = @CustomerId   
            AND CON.DeletedBy IS NULL   
            AND CON.DeletedAt IS NULL    
        --GROUP BY  
        --    LCC.CustomerContactId,                
        --    LCC.CustomerId,            
        --    LCC.ContactId,            
        --    LCC.ContactTypeId,            
        --    CT.Type,            
        --    CON.FirstName,            
        --    CON.LastName  
        ORDER BY   
            LCC.ContactId DESC                
    END TRY          
    BEGIN CATCH              
        DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()              
        DECLARE @ErrorSeverity int = ERROR_SEVERITY()              
        DECLARE @ErrorState int = ERROR_STATE()              
          
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)              
    END CATCH         
END  
GO
/****** Object:  StoredProcedure [dbo].[GetContactBySupplierId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
    
-- GetContactBySupplierId 2    
CREATE PROCEDURE [dbo].[GetContactBySupplierId]                      
@SupplierId int                       
AS                      
BEGIN                      
    SET NOCOUNT ON;    
        
    BEGIN TRY                       
        SELECT          
            SCC.SupplierContactId,                  
            SCC.SupplierId,              
            SCC.ContactId,              
            SCC.ContactTypeId,              
            CT.Type,              
            CON.FirstName,              
            CON.LastName,            
            ISNULL((    
                SELECT STUFF((    
                    SELECT DISTINCT ',' + ISNULL(E.EmailAddress, '')    
                    FROM [dbo].[Emails] E    
                    WHERE E.OwnerId = CON.ContactId AND E.OwnerTypeId = 4    
                      AND E.DeletedBy IS NULL AND E.DeletedAt IS NULL    
                    FOR XML PATH(''), TYPE    
                ).value('text()[1]', 'nvarchar(max)'), 1, 1, '')    
            ), '') AS EmailAddress,    
            ISNULL((    
                SELECT STUFF((    
                    SELECT DISTINCT ',' + ISNULL(P.PhoneNumber, '')    
                    FROM [dbo].[Phones] P    
                    WHERE P.OwnerId = CON.ContactId AND P.OwnerTypeId = 4    
                      AND P.DeletedBy IS NULL AND P.DeletedAt IS NULL    
                    FOR XML PATH(''), TYPE    
                ).value('text()[1]', 'nvarchar(max)'), 1, 1, '')    
            ), '') AS PhoneNumber,  
   SC.IsPrimary  
        FROM     
            [dbo].[L_SupplierContacts] SCC              
            LEFT JOIN [dbo].[Contacts] CON ON SCC.ContactId = CON.ContactId              
            LEFT JOIN [dbo].[ContactTypes] CT ON SCC.ContactTypeId = CT.ContactTypeId  
            LEFT JOIN [dbo].[L_SupplierContacts] SC ON SC.ContactId = CON.ContactId  
            --LEFT JOIN [dbo].[Emails] E ON CON.ContactId = E.OwnerId AND E.OwnerTypeId = 3 AND E.DeletedBy IS NULL AND E.DeletedAt IS NULL    
            --LEFT JOIN [dbo].[Phones] P ON CON.ContactId = P.OwnerId AND P.OwnerTypeId = 3 AND P.DeletedBy IS NULL AND P.DeletedAt IS NULL    
        WHERE      
            SCC.SupplierId = @SupplierId     
            AND CON.DeletedBy IS NULL     
            AND CON.DeletedAt IS NULL      
        --GROUP BY    
        --    SCC.CustomerContactId,                  
        --    SCC.CustomerId,              
        --    SCC.ContactId,              
        --    SCC.ContactTypeId,              
        --    CT.Type,              
        --    CON.FirstName,              
        --    CON.LastName    
        ORDER BY     
            SCC.ContactId DESC                  
    END TRY            
    BEGIN CATCH                
        DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
        DECLARE @ErrorSeverity int = ERROR_SEVERITY()                
        DECLARE @ErrorState int = ERROR_STATE()                
            
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
    END CATCH           
END 
GO
/****** Object:  StoredProcedure [dbo].[GetCustomerAuditHistoryByCustomerId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
  
--GetCustomerAuditHistoryByCustomerId 1106                   
CREATE PROCEDURE [dbo].[GetCustomerAuditHistoryByCustomerId]  
	@PageNumber INT = 1,            
	@PageSize INT = 25,            
--	@SearchText NVARCHAR(50) = '0',                     
	@TotalCount INT OUTPUT,
	@CustomerId INT                  
AS                    
BEGIN                    
 SET NOCOUNT ON;                    
 BEGIN TRY            
	DECLARE @Offset INT = (@PageNumber - 1) * @PageSize;            
 

	 -- Get the total count            
    SELECT @TotalCount = COUNT(*)            
    FROM [dbo].[CustomerAuditHistory] CAH
    LEFT JOIN Users U ON CAH.ChangedBy = U.UserId    
    WHERE (@CustomerId = 0 OR CAH.CustomerId = @CustomerId); 
	
           -- Select the data with the corrected WHERE clause 
        SELECT                    
            CAH.CustomerAuditHistoryId,    
            CAH.CustomerId,    
            CAH.EventName,    
            CAH.ChangedBy,    
            CAH.ChangedAt,    
            CAH.Description,  
            U.FirstName + ' ' + U.LastName AS Name,  
            CAH.EventStatus  
        FROM    
            [dbo].[CustomerAuditHistory] CAH  
        LEFT JOIN   
            Users U ON CAH.ChangedBy = U.UserId 
        WHERE   
            CAH.CustomerId = @CustomerId
        ORDER BY CustomerAuditHistoryId DESC 
		OFFSET @Offset ROWS            
    FETCH NEXT @PageSize ROWS ONLY;  
    END TRY                                    
BEGIN CATCH                            
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                            
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                            
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                            
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                            
END CATCH                     
                    
END 
GO
/****** Object:  StoredProcedure [dbo].[GetCustomerDocumentsById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
                
--GetCustomerDocumentsById 15                
CREATE PROCEDURE [dbo].[GetCustomerDocumentsById]                  
@CustomerId int                   
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                   
    SELECT
        CD.CustomerDocumentId,      
        CD.Name,
        CD.DocumentTypeId,
        DT.Type,
        CD.CustomerId,
        Cd.Attachment
    FROM [dbo].[CustomerDocuments] CD          
    left JOIN [dbo].[DocumentTypes] DT ON DT.DocumentTypeId= CD.DocumentTypeId
    WHERE  CD.CustomerId=@CustomerId AND CD.DeletedBy IS NULL AND CD.DeletedAt IS NULL              
    ORDER BY Cd.CustomerDocumentId DESC              
END TRY        
    BEGIN CATCH            
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()            
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()            
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()            
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)            
    END CATCH       
END         


GO
/****** Object:  StoredProcedure [dbo].[GetCustomerNotesByCustomerId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================  
-- Author:  <Author,,Name>  
-- Create date: <Create Date,,>  
-- Description: <Description,,>  
-- =============================================  
CREATE PROCEDURE [dbo].[GetCustomerNotesByCustomerId]  
 -- Add the parameters for the stored procedure here  
  @CustomerId int  
AS  
BEGIN  
  SET NOCOUNT ON;          
          
 SELECT  
  [CustomerNoteId],  
  [Note],  
  CASE
	WHEN CN.[UpdatedAt] IS NULL AND CN.[UpdatedBy] IS NULL THEN CN.[CreatedAt]    
	ELSE CN.[UpdatedAt]   
	END AS NoteDate,  
  U.FirstName + ' ' + U.LastName AS FullName
 FROM [dbo].[CustomerNotes]  CN
 INNER JOIN Users U 
	ON (CN.[UpdatedAt] IS NULL AND CN.[UpdatedBy] IS NULL AND U.UserId = CN.[CreatedBy])
	OR (CN.[UpdatedAt] IS NOT NULL AND CN.[UpdatedBy] IS NOT NULL AND U.UserId = CN.[UpdatedBy])
 WHERE  CustomerId=@CustomerId  
    
END   
GO
/****** Object:  StoredProcedure [dbo].[GetCustomers]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
      
--GetCustomers 1,150,'','0',500      
CREATE PROCEDURE [dbo].[GetCustomers]            
  @PageNumber INT = 1,            
  @PageSize INT = 25,            
  @SearchText NVARCHAR(50) = '0',            
  @StatusId VARCHAR(15) = NULL,            
  @TotalCount INT OUTPUT            
AS            
BEGIN            
    SET NOCOUNT ON;            
 BEGIN TRY          
    -- Calculate the offset for pagination            
    DECLARE @Offset INT = (@PageNumber - 1) * @PageSize;            
      
    DECLARE @StatusIdsTable TABLE (StatusId VARCHAR(15));      
         
    INSERT INTO @StatusIdsTable (StatusId)      
    SELECT value      
    FROM STRING_SPLIT(@StatusId, ',')      
    WHERE @StatusId IS NOT NULL; -- Filter out NULL values      
      
    -- Get the total count            
    SELECT @TotalCount = COUNT(*)            
    FROM [dbo].[Customers] C            
    LEFT JOIN [dbo].[Status] S ON C.StatusId = S.StatusId    
    LEFT JOIN [dbo].[L_CustomerInActiveReasons] CIAR ON C.CustomerId=CIAR.CustomerId  AND CIAR.DeletedAt IS NULL AND CIAR.DeletedBy IS NULL         
    WHERE            
        (@StatusId = '0' OR C.StatusId IN (SELECT StatusId FROM @StatusIdsTable))            
        AND C.DeletedBy IS NULL       
        AND C.DeletedAt IS NULL;      
      
    -- Select the data with the corrected WHERE clause            
    SELECT            
       C.CustomerId,      
       C.Name,      
       C.TaxId,      
       C.WebSite,      
       C.StatusId,      
       S.Status,    
       CIAR.InActiveReason,    
       C.UpdatedAt,
	   C.ResponsibleUserId,
	    U.FirstName + ' ' + U.LastName AS ResponsibleUserName
    FROM [dbo].[Customers] C            
    LEFT JOIN [dbo].[Status] S ON C.StatusId = S.StatusId     
    LEFT JOIN [dbo].[L_CustomerInActiveReasons] CIAR ON C.CustomerId=CIAR.CustomerId  AND CIAR.DeletedAt IS NULL AND CIAR.DeletedBy IS NULL  
	LEFT JOIN Users U ON U.UserId =C.ResponsibleUserId
    WHERE            
        (@StatusId = '0' OR C.StatusId IN (SELECT StatusId FROM @StatusIdsTable))       
        AND C.DeletedBy IS NULL       
        AND C.DeletedAt IS NULL            
    ORDER BY C.CustomerId DESC            
    OFFSET @Offset ROWS            
    FETCH NEXT @PageSize ROWS ONLY;            
      
END TRY        
    BEGIN CATCH            
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()            
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()            
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()            
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)            
    END CATCH       
END; 
GO
/****** Object:  StoredProcedure [dbo].[GetCustomersBasicInformationById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--GetCustomersBasicInformationById 16      
CREATE PROCEDURE [dbo].[GetCustomersBasicInformationById]                      
 @CustomerId int      
as                      
Begin                      
SET NOCOUNT ON;                      
BEGIN TRY                      
                      
 SELECT          
  C.Name,          
  C.GroupTypeId,    
  GT.Type,            
  C.TerritoryId,    
  T.Territory,            
  C.CountryId,    
  CS.Name AS CountryName,         
  E.EmailAddress,      
  C.Website,      
  C.TaxId,            
  C.IsCompany,  
  C.IsBuyingForThirdParty,
  C.StatusId,
  S.Status,
  C.ResponsibleUserId,
  U.FirstName + ' ' + U.LastName AS ResponsibleUserName  
 FROM [dbo].[Customers] C      
 LEFT JOIN [dbo].[CustomerNotes] CN ON C.CustomerId = CN.CustomerId      
 LEFT JOIN [dbo].[Emails] E ON C.CustomerId = E.OwnerId AND OwnerTypeId = 1    
 LEFT JOIN [dbo].[Countries] CS ON C.CountryId = CS.CountryId    
 LEFT JOIN [dbo].[GroupTypes] GT ON C.GroupTypeId = GT.GroupTypeId    
 LEFT JOIN [dbo].[Territories] T ON C.TerritoryId = T.TerritoryId
 LEFT JOIN [dbo].[Status] S ON S.StatusId = C.StatusId   
 LEFT JOIN Users U ON U.UserId =C.ResponsibleUserId
 WHERE C.CustomerId = @CustomerId      
 AND C.DeletedBy IS NULL       
 AND C.DeletedAt IS NULL                                      
END TRY                      
BEGIN CATCH                      
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                      
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                      
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                      
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                      
END CATCH                      
END 
GO
/****** Object:  StoredProcedure [dbo].[GetDefaultPaymentTemplete]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[GetDefaultPaymentTemplete] 
	 
AS
 
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                          
        
SELECT                  
 PaymentTermId,
 PaymentTerm
FROM [dbo].PaymentTerms
                                    
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                   
                  
END 
GO
/****** Object:  StoredProcedure [dbo].[GetDeliveryMethodsCustomerId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
            
--GetDeliveryMethodsCustomerId 83           
CREATE PROCEDURE [dbo].[GetDeliveryMethodsCustomerId]              
@CustomerId int               
AS              
BEGIN              
 SET NOCOUNT ON;              
         
 BEGIN TRY              
    SELECT  
        CDM.CustomerDeliveryMethodId,  
        CDM.CustomerId,  
        CDM.DeliveryMethodId,
        DM.IsForInternational,  
        DM.Name,    
        CDM.Charge,  
        CDM.IsPrimary  
    FROM [dbo].[L_CustomCharge_CustomerDeliveryMethods] CDM             
    left JOIN [dbo].[DeliveryMethods] DM ON DM.DeliveryMethodId= CDM.DeliveryMethodId  
    WHERE  CDM.CustomerId= @CustomerId AND CDM.DeletedBy IS NULL AND CDM.DeletedAt IS NULL          
    ORDER BY CDM.CustomerDeliveryMethodId DESC          
        
END TRY        
    BEGIN CATCH            
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()            
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()            
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()            
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)            
    END CATCH         
END   
  
  
GO
/****** Object:  StoredProcedure [dbo].[GetDetailsByCustomerId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[GetDetailsByCustomerId]
    @CustomerId int 
AS
BEGIN
    SET NOCOUNT ON;
    BEGIN TRY
         
        BEGIN
            SELECT
                CAS.[CustomerAccountingSettingId],
                CAS.PaymentTermId,
                CAS.PaymentMethodId,
                CAS.CreditLimit,
                CAS.BillingCurrency,
                CAS.InvoiceSubmissionInstruction
            FROM [dbo].[CustomerAccoutingSettings] CAS
            LEFT JOIN [dbo].[PaymentTerms] PT ON PT.PaymentTermId = CAS.PaymentTermId
            LEFT JOIN [dbo].[PaymentMethods] DM ON DM.PaymentMethodId = CAS.PaymentMethodId
            WHERE CAS.CustomerId = @CustomerId;
        END
    END TRY
    BEGIN CATCH
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity NVARCHAR(MAX) = ERROR_SEVERITY();
        DECLARE @ErrorState NVARCHAR(MAX) = ERROR_STATE();
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH;
END
GO
/****** Object:  StoredProcedure [dbo].[GetEmailByContactId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
            
--GetEmailByContactId 2            
CREATE PROCEDURE [dbo].[GetEmailByContactId]              
@ContactId int,
@OwnerTypeId tinyint               
AS              
BEGIN              
 SET NOCOUNT ON;              
   BEGIN TRY              
        SELECT      
        [EmailId],      
        [EmailAddress],  
        [IsPrimary]      
        FROM [dbo].[Emails]      
        WHERE  OwnerId=@ContactId AND OwnerTypeId=@OwnerTypeId AND DeletedBy IS NULL AND DeletedAt IS NULL          
        ORDER BY EmailId DESC          
END TRY        
    BEGIN CATCH            
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()            
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()            
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()            
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)            
    END CATCH         
END 
GO
/****** Object:  StoredProcedure [dbo].[GetPhoneByContactId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
              
-- GetPhoneByContactId 2              
CREATE PROCEDURE [dbo].[GetPhoneByContactId]                
@ContactId int                 
AS                
BEGIN                
 SET NOCOUNT ON;        
 BEGIN TRY        
                
    SELECT        
    P.[PhoneId],        
    P.[PhoneNumber],      
    P.[PhoneCode],    
    P.[PhoneTypeId],    
    P.[Extension],  
    PT.[Type] AS PhoneType ,
    P.[IsPrimary]
    FROM [dbo].[Phones] P  
 LEFT JOIN [dbo].[PhoneTypes] PT ON P.PhoneTypeId = PT.PhoneTypeId  
    WHERE  OwnerId=@ContactId AND DeletedBy IS NULL AND DeletedAt IS NULL            
    ORDER BY [PhoneId] DESC        
          
END TRY          
    BEGIN CATCH              
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()              
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()              
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()              
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)              
    END CATCH              
END 
GO
/****** Object:  StoredProcedure [dbo].[GetRoleByRoleId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GetRoleByRoleId]              
 @RoleId SMALLINT             
as              
Begin              
SET NOCOUNT ON;              
BEGIN TRY              
              
  SELECT            
  RoleName
  FROM [dbo].[Roles]            
  WHERE RoleId = @RoleId
  AND [DeletedBy] IS NULL AND DeletedAt  IS NULL          
          
END TRY              
BEGIN CATCH              
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()              
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()              
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()              
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)              
END CATCH              
END 
GO
/****** Object:  StoredProcedure [dbo].[GetRoles]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--======================================================================                                
   --GetRoles 1,25,'a',500                      
CREATE PROCEDURE [dbo].[GetRoles]                                        
    @PageNumber INT = 1,                
    @PageSize INT = 25,                
    @SearchText NVARCHAR(200),                
    @TotalCount INT OUTPUT                                       
AS                                        
BEGIN                   
              
    SET NOCOUNT ON;                
    DECLARE @Offset INT = (@PageNumber - 1) * @PageSize;                
                
    -- Get the total count                
    SELECT @TotalCount = COUNT(*)                
    FROM [dbo].[Roles] R                     
    WHERE         
	  R.DeletedAt IS NULL AND R.DeletedBy IS NULL AND         
	  (
	      @SearchText = '' OR R.RoleName LIKE '%' + @SearchText + '%'
	  )    
             
    SELECT
		RoleId,
		RoleName
   FROM [dbo].[Roles] R                         
    WHERE         
	R.DeletedAt IS NULL AND R.DeletedBy IS NULL AND 
	(
		@SearchText = '' OR R.RoleName LIKE '%' + @SearchText + '%'  
	)     
      
    ORDER BY [CreatedAt] DESC                
    OFFSET @Offset ROWS                
    FETCH NEXT @PageSize ROWS ONLY;               
                                    
END 
GO
/****** Object:  StoredProcedure [dbo].[GetRolesMappingByRoleId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- GetRolesMappingByRoleId 4,1,25,'',200          
CREATE PROCEDURE [dbo].[GetRolesMappingByRoleId]                                                          
 @RoleId tinyint,        
 @PageNumber int = 1,                                          
 @PageSize int=25,      
 @SearchText NVARCHAR(200),      
 @TotalCount int OUTPUT          
AS                        
BEGIN                        
 SET NOCOUNT ON;                        
-- Calculate the offset for pagination          
    DECLARE @Offset INT = (@PageNumber - 1) * @PageSize;        
         
 -- Get the total count          
    SELECT @TotalCount = COUNT(*)          
    FROM [dbo].[L_UserRoles] UR
	INNER JOIN [dbo].[Users] U ON U.UserId = UR.UserId
    INNER JOIN [dbo].[Roles] R ON R.RoleId= UR.RoleId
    WHERE UR.RoleId = @RoleId and UR.DeletedBy IS NULL AND UR.DeletedAt IS NULL         
    AND (@SearchText IS NULL 
      OR U.UserName LIKE '%' + @SearchText + '%' 
      OR R.RoleName LIKE '%' + @SearchText + '%');        
      
 SELECT
 UR.UserRoleId,
 UR.RoleId,
 R.RoleName,
 UR.UserId,
 U.UserName,
 UR.CreatedAt            
 from [dbo].[L_UserRoles] UR             
 INNER JOIN [dbo].[Users] U ON U.UserId = UR.UserId
 INNER JOIN [dbo].[Roles] R ON R.RoleId= UR.RoleId
 where          
 UR.RoleId= @RoleId and          
 UR.DeletedAt IS NULL and UR.DeletedBy IS NULL      
 AND (@SearchText IS NULL 
      OR U.UserName LIKE '%' + @SearchText + '%' 
      OR R.RoleName LIKE '%' + @SearchText + '%')       
            
    ORDER BY RoleName ASC          
    OFFSET @Offset ROWS          
    FETCH NEXT @PageSize ROWS ONLY;                     
                       
END   
GO
/****** Object:  StoredProcedure [dbo].[GetSecurityPermissionByUserId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- GetSecurityPermissionByUserId 3  
CREATE PROCEDURE [dbo].[GetSecurityPermissionByUserId]    
@UserId INT    
AS    
BEGIN    
 SET NOCOUNT ON;    
    
 SELECT     
 SecurityKeyName,    
 IsMenu,    
 SecurityKeyParentId,    
 [dbo].[GetSecurityPermissionByUserAndKey](sk.SecurityKeyId,@UserId,GrantDenyFlag) as SecuritySettingId    
 FROM  SecurityKey sk     
END 
GO
/****** Object:  StoredProcedure [dbo].[GetShppingDeliveryCarrierAndDeliveryMethodsById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--GetShppingDeliveryCarrierAndDeliveryMethodsById 15 
CREATE PROCEDURE [dbo].[GetShppingDeliveryCarrierAndDeliveryMethodsById]  
    @CustomerId int   
AS  
BEGIN  
    SET NOCOUNT ON;  
    BEGIN TRY  
           
        BEGIN  
            SELECT  
                CAS.DeliveryAccountId,
                DA.NAME
            FROM [dbo].[CustomerAccoutingSettings] CAS
            LEFT JOIN [dbo].[DeliveryAccounts] DA ON DA.DeliveryAccountId = CAS.DeliveryAccountId  
            WHERE CAS.CustomerId = @CustomerId ;  
        END  
    END TRY  
    BEGIN CATCH  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();  
        DECLARE @ErrorSeverity NVARCHAR(MAX) = ERROR_SEVERITY();  
        DECLARE @ErrorState NVARCHAR(MAX) = ERROR_STATE();  
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);  
    END CATCH;  
END  
GO
/****** Object:  StoredProcedure [dbo].[GetShppingDeliveryCarriersByCustomerId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
          
--GetShppingDeliveryCarriersByCustomerId 15         
CREATE PROCEDURE [dbo].[GetShppingDeliveryCarriersByCustomerId]            
@CustomerId int             
AS            
BEGIN            
 SET NOCOUNT ON;            
       
 BEGIN TRY            
    SELECT  
        CDC.CustomerDeliveryCarrierId,
        CDC.CarrierId,
        DC.Carrier,
        CDC.AccountNumber,
        CDC.IsPrimary,
        CDC.CustomerId
    FROM [dbo].[L_CustomerDeliveryCarriers] CDC            
    left JOIN [dbo].[DeliveryCarriers] DC ON DC.CarrierId= CDC.CarrierId        
    WHERE  CDC.CustomerId= @CustomerId AND CDC.DeletedBy IS NULL AND CDC.DeletedAt IS NULL        
    ORDER BY CDC.CustomerDeliveryCarrierId DESC        
      
END TRY      
    BEGIN CATCH          
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()          
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()          
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()          
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)          
    END CATCH       
END 
GO
/****** Object:  StoredProcedure [dbo].[GetSupplierAuditHistoryBySupplierId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[GetSupplierAuditHistoryBySupplierId]
	@PageNumber INT = 1,            
	@PageSize INT = 25,                               
	@TotalCount INT OUTPUT,
	@SupplierId INT  
AS 
BEGIN
	
	SET NOCOUNT ON;
		BEGIN TRY 
	DECLARE @Offset INT = (@PageNumber - 1) * @PageSize;  
	
	   SELECT @TotalCount = COUNT(*)  
	    FROM [dbo].SupplierAuditHistory SAH
		  LEFT JOIN Users U ON SAH.ChangedBy = U.UserId    
    WHERE  (SupplierId = 0 OR SAH .SupplierId  = @SupplierId )
                           
        SELECT                    
            SAH.SupplierAuditHistoryId,    
            SAH.SupplierId ,    
            SAH.EventName,    
           SAH.ChangedBy,    
            SAH.ChangedAt,    
            SAH.Description,  
            U.FirstName + ' ' + U.LastName AS Name,  
            SAH.EventStatus  
        FROM    
            [dbo].[SupplierAuditHistory] SAH  
        LEFT JOIN   
            Users U ON SAH.ChangedBy = U.UserId 
        WHERE SAH .SupplierId  = @SupplierId 
        ORDER BY SupplierAuditHistoryId DESC    
			OFFSET @Offset ROWS            
    FETCH NEXT @PageSize ROWS ONLY;  
    END TRY                                    
BEGIN CATCH                            
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                            
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                            
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                            
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                            
END CATCH   
 
END

GO
/****** Object:  StoredProcedure [dbo].[GetSupplierBasicInformationById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--GetSupplierBasicInformationById 7         
CREATE PROCEDURE [dbo].[GetSupplierBasicInformationById]                          
 @SupplierId int          
as                          
Begin                          
SET NOCOUNT ON;                          
BEGIN TRY                          
                          
 SELECT  
  SP.SupplierId,              
  SP.Name,  
  SP.DbaName,  
  SP.SupplierTypeId,  
  SPT.Type AS SupplierType,               
  SP.GroupTypeId,        
  GT.Type As GroupType,                
  SP.TerritoryId,        
  T.Territory,                
  SP.CountryId,        
  CS.Name AS CountryName,             
  SP.Website,          
  SP.TaxId,                
  SP.StatusId,
  S.Status,
  E.EmailAddress,
  SP.ResponsibleUserId,
   U.FirstName + ' ' + U.LastName AS ResponsibleUser  

 FROM [dbo].[Suppliers] SP    
 LEFT JOIN [dbo].[SupplierTypes] SPT ON SPT.SupplierTypeId = SP.SupplierTypeId 
 LEFT JOIN [dbo].[Emails] E ON SP.SupplierId = E.OwnerId AND OwnerTypeId = 2         
 LEFT JOIN [dbo].[Countries] CS ON CS.CountryId = SP.CountryId        
 LEFT JOIN [dbo].[GroupTypes] GT ON GT.GroupTypeId = SP.GroupTypeId        
 LEFT JOIN [dbo].[Territories] T ON T.TerritoryId = SP.TerritoryId    
 LEFT JOIN [dbo].[Status] S ON S.StatusId = SP.StatusId    
 LEFT JOIN Users U ON U.UserId =SP.ResponsibleUserId
 WHERE SP.SupplierId = @SupplierId  
 AND SP.DeletedBy IS NULL           
 AND SP.DeletedAt IS NULL                                          
END TRY                          
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                          
END 
GO
/****** Object:  StoredProcedure [dbo].[GetSupplierDocuementById]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetSupplierDocuementById]
@SupplierId int                   
AS                  
BEGIN                  
 SET NOCOUNT ON;                  
BEGIN TRY                   
    SELECT
        SD.SupplierDocumentId,      
        SD.Name,
        SD.DocumentTypeId,
        DT.Type,
        SD.SupplierId,
        SD.Attachment
    FROM [dbo].[SupplierDocuments] SD          
    left JOIN [dbo].[DocumentTypes] DT ON DT.DocumentTypeId= SD.DocumentTypeId
    WHERE  SD.SupplierId=@SupplierId AND SD.DeletedBy IS NULL AND SD.DeletedAt IS NULL              
    ORDER BY SD.SupplierDocumentId DESC              
END TRY        
    BEGIN CATCH            
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()            
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()            
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()            
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)            
    END CATCH       
END       
GO
/****** Object:  StoredProcedure [dbo].[GetSupplierNotesBySupplierId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetSupplierNotesBySupplierId]
	-- Add the parameters for the stored procedure here
	  @SupplierId int  
AS
BEGIN
	
	SET NOCOUNT ON;
	 SELECT 
	[SupplierNoteId],
  [Note],  
  CASE
	WHEN SN.[UpdatedAt] IS NULL AND SN.[UpdatedBy] IS NULL THEN SN.[CreatedAt]    
	ELSE SN.[UpdatedAt]   
	END AS NoteDate,  
  U.FirstName + ' ' + U.LastName AS FullName
 FROM [dbo].[SupplierNotes] SN
 INNER JOIN Users U 
	ON (SN.[UpdatedAt] IS NULL AND SN.[UpdatedBy] IS NULL AND U.UserId = SN.[CreatedBy])
	OR (SN.[UpdatedAt] IS NOT NULL AND SN.[UpdatedBy] IS NOT NULL AND U.UserId =SN.[UpdatedBy])
 WHERE SupplierId=@SupplierId
END

GO
/****** Object:  StoredProcedure [dbo].[GetSuppliers]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
        
--GetSuppliers 1,50,'','0',500        
CREATE PROCEDURE [dbo].[GetSuppliers]              
  @PageNumber INT = 1,              
  @PageSize INT = 25,              
  @SearchText NVARCHAR(50) = '0',              
  @StatusId VARCHAR(15) = NULL,              
  @TotalCount INT OUTPUT              
AS              
BEGIN              
    SET NOCOUNT ON;              
 BEGIN TRY            
    -- Calculate the offset for pagination              
    DECLARE @Offset INT = (@PageNumber - 1) * @PageSize;              
        
    DECLARE @StatusIdsTable TABLE (StatusId VARCHAR(15));        
           
    INSERT INTO @StatusIdsTable (StatusId)        
    SELECT value        
    FROM STRING_SPLIT(@StatusId, ',')        
    WHERE @StatusId IS NOT NULL; -- Filter out NULL values        
        
    -- Get the total count              
    SELECT @TotalCount = COUNT(*)              
    FROM [dbo].[Suppliers] SP              
    LEFT JOIN [dbo].[Status] S ON S.StatusId = SP.StatusId      
    LEFT JOIN [dbo].[L_SupplierInActiveReasons] SIAR ON SIAR.SupplierId =SP.SupplierId AND SIAR.DeletedAt IS NULL AND SIAR.DeletedBy IS NULL 
    WHERE              
        (@StatusId = '0' OR SP.StatusId IN (SELECT StatusId FROM @StatusIdsTable))              
        AND SP.DeletedBy IS NULL         
        AND SP.DeletedAt IS NULL;        
        
    -- Select the data with the corrected WHERE clause              
    SELECT              
       SP.SupplierId,        
       SP.Name,        
       SP.TaxId,        
       SP.WebSite,        
       SP.StatusId,        
       S.Status,      
       SIAR.InActiveReason,      
       SP.UpdatedAt ,
	   SP.ResponsibleUserId
    FROM [dbo].[Suppliers] SP           
     LEFT JOIN [dbo].[Status] S ON S.StatusId = SP.StatusId      
    LEFT JOIN [dbo].[L_SupplierInActiveReasons] SIAR ON SIAR.SupplierId =SP.SupplierId AND SIAR.DeletedAt IS NULL AND SIAR.DeletedBy IS NULL
   LEFT JOIN Users U on U.UserId = SP.ResponsibleUserId
   WHERE              
        (@StatusId = '0' OR SP.StatusId IN (SELECT StatusId FROM @StatusIdsTable))              
        AND SP.DeletedBy IS NULL         
        AND SP.DeletedAt IS NULL  
               
    ORDER BY SP.SupplierId DESC              
    OFFSET @Offset ROWS              
    FETCH NEXT @PageSize ROWS ONLY;              
        
END TRY          
    BEGIN CATCH              
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()              
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()              
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()              
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)              
    END CATCH         
END; 
GO
/****** Object:  StoredProcedure [dbo].[GetUnAssignedUserByRoleId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GetUnAssignedUserByRoleId]      
@RoleId tinyint       
AS      
BEGIN      
 SET NOCOUNT ON;      
      
SELECT U.UserId, U.UserName      
FROM [dbo].[Users] U      
LEFT JOIN [dbo].[L_UserRoles] UR ON U.UserId = UR.UserId      
WHERE U.UserId NOT IN (      
    SELECT UserId      
    FROM [dbo].[L_UserRoles]       
    WHERE UR.RoleId = @RoleId  AND UR.DeletedAt IS NULL AND UR.DeletedBy IS NULL        
) and U.DeletedAt IS NULL AND U.DeletedBy IS NULL --AND UR.DeletedAt IS NULL AND UR.DeletedBy IS NULL     
END 
GO
/****** Object:  StoredProcedure [dbo].[GetUserByUserId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GetUserByUserId]            
 @UserId SMALLINT           
as            
Begin            
SET NOCOUNT ON;            
BEGIN TRY            
            
  SELECT          
 FirstName,  
 LastName,  
    UserName,       
    IsActive        
  FROM [dbo].[Users]          
  WHERE UserId = @UserId      
  AND [DeletedBy] IS NULL AND DeletedAt  IS NULL        
        
END TRY            
BEGIN CATCH            
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()            
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()            
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()            
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)            
END CATCH            
END 
GO
/****** Object:  StoredProcedure [dbo].[GetUserByUserName]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--GetUserByUserName ''
CREATE PROCEDURE [dbo].[GetUserByUserName]     
@UserName nvarchar(200)    
AS    
BEGIN    
	-- SET NOCOUNT ON added to prevent extra result sets from    
	-- interfering with SELECT statements.    
	SET NOCOUNT ON;    

	BEGIN TRY      
	SELECT    
		U.UserId,    
		U.UserName,  
		U.HashedPassword,  
		U.PasswordSalt,  
		U.UserLoginTime,  
		U.IsActive,
		CONCAT(U.FirstName, ' ', U.LastName) AS FullName
	FROM [dbo].[Users] AS U    
	WHERE U.UserName = @UserName     
	AND U.[DeletedBy] IS NULL AND U.DeletedAt IS NULL  
      
	END TRY      
	BEGIN CATCH      
		DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()      
		DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()      
		DECLARE @ErrorState nvarchar(max) = ERROR_STATE()      
		RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)      
	END CATCH     
END 
GO
/****** Object:  StoredProcedure [dbo].[GetUserCheckListByEventId]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
-- GetUserCheckListBtEventId 1
CREATE PROCEDURE [dbo].[GetUserCheckListByEventId] 
	 @EventId int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

   BEGIN TRY                     
        SELECT        
             CL.ChecklistId,
			 CL.ChecklistName,
			 CL.EventId
			        
        FROM   
            [dbo].[Checklists] CL            
           
        WHERE    
            CL.EventId = @EventId  
                            
    END TRY          
    BEGIN CATCH              
        DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()              
        DECLARE @ErrorSeverity int = ERROR_SEVERITY()              
        DECLARE @ErrorState int = ERROR_STATE()              
          
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)              
    END CATCH      
END
GO
/****** Object:  StoredProcedure [dbo].[GetUsers]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--======================================================================                              
   --GetUsers 1,25,'a',500                    
CREATE PROCEDURE [dbo].[GetUsers]                                      
    @PageNumber INT = 1,              
    @PageSize INT = 25,              
    @SearchText NVARCHAR(200),              
    @TotalCount INT OUTPUT                                     
AS                                      
BEGIN                 
            
    SET NOCOUNT ON;              
    DECLARE @Offset INT = (@PageNumber - 1) * @PageSize;              
              
    -- Get the total count              
    SELECT @TotalCount = COUNT(*)              
    FROM [dbo].[Users] U                   
    WHERE 
        U.DeletedAt IS NULL AND U.DeletedBy IS NULL AND
        (
            @SearchText = '' OR
            U.UserName LIKE '%' + @SearchText + '%' OR
            U.FirstName LIKE '%' + @SearchText + '%' OR
            U.LastName LIKE '%' + @SearchText + '%'
        )  
           
    SELECT              
      U.UserId,  
      U.FirstName,  
      U.LastName,  
      U.UserName,    
      U.IsActive,    
      U.CreatedAt    
   FROM [dbo].[Users] U                       
    WHERE 
        U.DeletedAt IS NULL AND U.DeletedBy IS NULL AND
        (
            @SearchText = '' OR
            U.UserName LIKE '%' + @SearchText + '%' OR
            U.FirstName LIKE '%' + @SearchText + '%' OR
            U.LastName LIKE '%' + @SearchText + '%'
        )   
    
	ORDER BY [CreatedAt] DESC              
    OFFSET @Offset ROWS              
    FETCH NEXT @PageSize ROWS ONLY;             
                                  
END 
GO
/****** Object:  StoredProcedure [dbo].[test]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--test 86
--ALTER PROCEDURE [dbo].[test]                  
--@CustomerId int                   
--AS                  
--BEGIN                  
--    SET NOCOUNT ON;
    
--    BEGIN TRY                   
--        SELECT      
--            LCC.CustomerContactId,              
--            LCC.[CustomerId],          
--            LCC.ContactId,          
--            LCC.ContactTypeId,          
--            CT.Type,          
--            CON.FirstName,          
--            CON.LastName,        
--            STRING_AGG(E.EmailAddress, ', ') AS EmailAddress,
--            STRING_AGG(P.PhoneNumber, ', ') AS PhoneNumber
--        FROM 
--            [dbo].[L_CustomerContacts] LCC          
--            LEFT JOIN [dbo].[Contacts] CON ON LCC.ContactId =CON.ContactId          
--            LEFT JOIN [dbo].[ContactTypes] CT ON LCC.ContactTypeId=CT.ContactTypeId    
--            LEFT JOIN [dbo].[Emails] E ON CON.ContactId = E.OwnerId AND E.OwnerTypeId=3
--            LEFT JOIN [dbo].[Phones] P ON CON.ContactId = p.OwnerId AND P.OwnerTypeId=3
--        WHERE  
--            LCC.CustomerId = @CustomerId 
--            AND CON.DeletedBy IS NULL 
--            AND CON.DeletedAt IS NULL  
--            AND E.DeletedBy IS NULL 
--            AND E.DeletedAt IS NULL 
--            AND P.DeletedBy IS NULL 
--            AND P.DeletedAt IS NULL 
              
--        GROUP BY
--            LCC.CustomerContactId,              
--            LCC.CustomerId,          
--            LCC.ContactId,          
--            LCC.ContactTypeId,          
--            CT.Type,          
--            CON.FirstName,          
--            CON.LastName
--        ORDER BY 
--            LCC.ContactId DESC              
--    END TRY        
--    BEGIN CATCH            
--        DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()            
--        DECLARE @ErrorSeverity int = ERROR_SEVERITY()            
--        DECLARE @ErrorState int = ERROR_STATE()            
        
--        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)            
--    END CATCH       
--END        

CREATE PROCEDURE [dbo].[test]                  
@CustomerId int                   
AS                  
BEGIN                  
    SET NOCOUNT ON;
    
    BEGIN TRY                   
        SELECT      
            LCC.CustomerContactId,              
            LCC.[CustomerId],          
            LCC.ContactId,          
            LCC.ContactTypeId,          
            CT.Type,          
            CON.FirstName,          
            CON.LastName,        
            ISNULL((
                SELECT STUFF((
                    SELECT DISTINCT ',' + ISNULL(E.EmailAddress, '')
                    FROM [dbo].[Emails] E
                    WHERE E.OwnerId = CON.ContactId AND E.OwnerTypeId = 3
                      AND E.DeletedBy IS NULL AND E.DeletedAt IS NULL
                    FOR XML PATH(''), TYPE
                ).value('text()[1]', 'nvarchar(max)'), 1, 1, '')
            ), '') AS EmailAddress,
            ISNULL((
                SELECT STUFF((
                    SELECT DISTINCT ',' + ISNULL(P.PhoneNumber, '')
                    FROM [dbo].[Phones] P
                    WHERE P.OwnerId = CON.ContactId AND P.OwnerTypeId = 3
                      AND P.DeletedBy IS NULL AND P.DeletedAt IS NULL
                    FOR XML PATH(''), TYPE
                ).value('text()[1]', 'nvarchar(max)'), 1, 1, '')
            ), '') AS PhoneNumber
        FROM 
            [dbo].[L_CustomerContacts] LCC          
            LEFT JOIN [dbo].[Contacts] CON ON LCC.ContactId = CON.ContactId          
            LEFT JOIN [dbo].[ContactTypes] CT ON LCC.ContactTypeId = CT.ContactTypeId    
            --LEFT JOIN [dbo].[Emails] E ON CON.ContactId = E.OwnerId AND E.OwnerTypeId = 3 AND E.DeletedBy IS NULL AND E.DeletedAt IS NULL
            --LEFT JOIN [dbo].[Phones] P ON CON.ContactId = P.OwnerId AND P.OwnerTypeId = 3 AND P.DeletedBy IS NULL AND P.DeletedAt IS NULL
        WHERE  
            LCC.CustomerId = @CustomerId 
            AND CON.DeletedBy IS NULL 
            AND CON.DeletedAt IS NULL  
        --GROUP BY
        --    LCC.CustomerContactId,              
        --    LCC.CustomerId,          
        --    LCC.ContactId,          
        --    LCC.ContactTypeId,          
        --    CT.Type,          
        --    CON.FirstName,          
        --    CON.LastName
        ORDER BY 
            LCC.ContactId DESC              
    END TRY        
    BEGIN CATCH            
        DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()            
        DECLARE @ErrorSeverity int = ERROR_SEVERITY()            
        DECLARE @ErrorState int = ERROR_STATE()            
        
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)            
    END CATCH       
END

GO
/****** Object:  StoredProcedure [dbo].[UpdateAddAddress]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UpdateAddAddress]                    
@AddressId INT,            
@CustomerId INT,              
@AddressTypeId SMALLINT,              
@AddressLine1 VARCHAR(250),              
@AddressLine2 VARCHAR(250),              
@AddressLine3 VARCHAR(250),              
@AddressLine4 VARCHAR(250),              
@AddressLine5 VARCHAR(250),              
@CountryId SMALLINT,              
@StateId INT,              
@CityId INT,              
@ZipCode INT,              
@UpdatedBy SMALLINT                                      
AS                          
BEGIN                          
 SET NOCOUNT ON;                          
BEGIN TRY           
    DECLARE @AddressType VARCHAR(100);          
    DECLARE @Title VARCHAR(100);           
          
              
    SELECT @AddressType = Type FROM [dbo].[AddressTypes] WHERE [AddressTypeId] = @AddressTypeId;                                
    SET @Title = CAST(@AddressId AS VARCHAR(50)) + '_' + @AddressLine1 + '_' + @AddressType;           
           
     IF NOT EXISTS (SELECT 1 FROM [dbo].[Addresses] WHERE AddressId = @AddressId)                        
     BEGIN                        
          SELECT @AddressId AS KeyValue,                                 
          'NO RECORD FOUND' AS ErrorMessage;              
     RETURN;            
     END              
        IF EXISTS (SELECT 1 FROM [dbo].[Addresses]  WHERE AddressId = @AddressId     
        AND ( AddressLine1 != @AddressLine1 OR AddressLine2 != @AddressLine2 OR AddressLine3 != @AddressLine3 OR  AddressLine4 != @AddressLine4 OR AddressLine5 != @AddressLine5 OR CountryId != @CountryId OR StateId != @StateId OR CityId != @CityId OR ZipCode != @ZipCode))         
        BEGIN          
        -- Update address information              
        UPDATE [dbo].[Addresses]              
        SET                 
         Title = @Title,              
         AddressLine1 = @AddressLine1,              
         AddressLine2 = @AddressLine2,              
         AddressLine3 = @AddressLine3,              
         AddressLine4 = @AddressLine4,              
         AddressLine5 = @AddressLine5,              
         CountryId = @CountryId,              
         StateId = @StateId,              
         CityId = @CityId,              
         ZipCode = @ZipCode,              
         UpdatedBy = @UpdatedBy,              
         UpdatedAt = GETDATE()              
        WHERE AddressId = @AddressId;               
            
        SELECT @AddressId AS KeyValue,                                 
        'Address Information Updated' AS ErrorMessage;              
    END    
    ELSE    
    BEGIN    
        SELECT @AddressId AS KeyValue,                                 
        'Address Information Updated' AS ErrorMessage;              
    END                 
END TRY                                      
BEGIN CATCH                                    
 DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                                    
 DECLARE @ErrorSeverity INT = ERROR_SEVERITY();                                    
 DECLARE @ErrorState INT = ERROR_STATE();                                    
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                                    
END CATCH                                    
END 
GO
/****** Object:  StoredProcedure [dbo].[UpdateAddressForCustomer]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UpdateAddressForCustomer]      
@CustomerAddressId INT,          
@CustomerId INT,          
@AddressTypeId SMALLINT,          
@AddressId INT,          
@IsPreferredBilling BIT,          
@IsPreferredShipping BIT,          
@UpdatedBy SMALLINT          
AS          
BEGIN          
    SET NOCOUNT ON;          
    BEGIN TRY          
          
        IF EXISTS (SELECT 1 FROM [dbo].[L_CustomerAddresses] WHERE CustomerAddressId = @CustomerAddressId AND CustomerId = @CustomerId AND AddressId = @AddressId AND (AddressTypeId != @AddressTypeId OR IsPreferredBilling != @IsPreferredBilling OR IsPreferredShipping != @IsPreferredShipping))  
        BEGIN
            
            IF @IsPreferredShipping = 1
            BEGIN
                UPDATE [dbo].[L_CustomerAddresses]
                SET IsPreferredShipping = 0
                WHERE CustomerId = @CustomerId AND AddressTypeId = @AddressTypeId AND CustomerAddressId != @CustomerAddressId;
            END
            
            IF @IsPreferredBilling = 1
            BEGIN
                UPDATE [dbo].[L_CustomerAddresses]
                SET IsPreferredBilling = 0
                WHERE CustomerId = @CustomerId AND AddressTypeId = @AddressTypeId AND CustomerAddressId != @CustomerAddressId;
            END  

            UPDATE [dbo].[L_CustomerAddresses]          
            SET          
                AddressTypeId = @AddressTypeId,          
                IsPreferredBilling = @IsPreferredBilling,          
                IsPreferredShipping = @IsPreferredShipping          
            WHERE          
                CustomerAddressId=@CustomerAddressId AND CustomerId = @CustomerId AND AddressId=@AddressId;          
          
            -- Return a success message          
            SELECT @AddressId as KeyValue,          
            'Customer address linkup Updated' as ErrorMessage;          
       END  
    END TRY          
    BEGIN CATCH          
        -- Handle the error          
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();          
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();          
        DECLARE @ErrorState INT = ERROR_STATE();          
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);          
    END CATCH          
END; 
GO
/****** Object:  StoredProcedure [dbo].[UpdateAddressForSupplier]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UpdateAddressForSupplier]    
@SupplierId int,      
@AddressTypeId SMALLINT,    
@AddressId INT,     
@UpdatedBy SMALLINT    
AS    
BEGIN    
    SET NOCOUNT ON;    
    BEGIN TRY    
  
        UPDATE [dbo].[L_SupplierAddresses]  
        SET    
            AddressTypeId = @AddressTypeId  
        WHERE    
            SupplierId = @SupplierId AND AddressId=@AddressId;    
    
        SELECT @AddressId as KeyValue,    
               'Supplier address linkup Updated' as ErrorMessage;    
    END TRY    
    BEGIN CATCH    
  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();    
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();    
        DECLARE @ErrorState INT = ERROR_STATE();    
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);    
    END CATCH    
END;    
GO
/****** Object:  StoredProcedure [dbo].[UpdateContactEmail]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
         
CREATE PROCEDURE [dbo].[UpdateContactEmail]          
@EmailId TINYINT,    
@EmailAddress VARCHAR(255),              
@UpdatedBy SMALLINT          
AS          
BEGIN          
 SET NOCOUNT ON;          
BEGIN TRY 
  DECLARE @OwnerId AS bigint
  DECLARE @OwnerTypeId AS SMALLINT   
 
 SELECT @OwnerId = OwnerId FROM [dbo].[Emails] WHERE EmailId = @EmailId AND OwnerTypeId=3 AND DeletedAt IS NULL AND DeletedBy IS NULL
 SELECT @OwnerTypeId = OwnerTypeId FROM [dbo].[Emails] WHERE EmailId = @EmailId AND OwnerTypeId=3 AND DeletedAt IS NULL AND DeletedBy IS NULL
                   
IF NOT EXISTS (SELECT EmailId FROM [dbo].[Emails] WHERE EmailId = @EmailId)          
BEGIN          
  SELECT @EmailId as KeyValue,                   
  'NO RECORD FOUND' as ErrorMessage          
END          
ELSE          
BEGIN          

     IF EXISTS (SELECT 1 FROM [dbo].[Emails] WHERE EmailAddress=@EmailAddress AND OwnerId=@OwnerId AND OwnerTypeId=@OwnerTypeId 
     AND DeletedAt IS NULL AND DeletedBy IS NULL)              
     BEGIN            
         SELECT CAST(0 AS INT) as KeyValue,             
         'Email address already exists.' as ErrorMessage;            
     END
     ELSE
     BEGIN            
         UPDATE [dbo].[Emails] SET    
            EmailAddress=@EmailAddress,    
            UpdatedBy = @UpdatedBy,          
            UpdatedAt = GETDATE()          
         WHERE EmailId = @EmailId  
          
         SELECT @EmailId as KeyValue,                   
         'Email Updated' as ErrorMessage 
     END          
END          
          
END TRY                      
BEGIN CATCH                    
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                    
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                    
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                    
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                    
END CATCH               
          
          
END 


select * from Emails
GO
/****** Object:  StoredProcedure [dbo].[UpdateContactPhone]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
             
CREATE PROCEDURE [dbo].[UpdateContactPhone]              
@PhoneId TINYINT,        
@PhoneNumber VARCHAR(20),      
@PhoneCode VARCHAR(10),      
@UpdatedBy SMALLINT              
AS              
BEGIN              
 SET NOCOUNT ON;              
BEGIN TRY                        
IF NOT EXISTS (SELECT PhoneId FROM [dbo].[Phones] WHERE PhoneId = @PhoneId)              
BEGIN              
  SELECT @PhoneId as KeyValue,                       
  'NO RECORD FOUND' as ErrorMessage              
END              
ELSE              
BEGIN  
     DECLARE @OwnerId AS BIGINT     
     SELECT @OwnerId = OwnerId FROM [dbo].[Phones] WHERE PhoneNumber = @PhoneNumber AND OwnerTypeId=3 AND DeletedAt IS NULL AND DeletedBy IS NULL  
  
    IF EXISTS (SELECT 1 FROM [dbo].[Phones] WHERE PhoneNumber=@PhoneNumber AND OwnerId=@OwnerId AND  PhoneCode=@PhoneCode   
     AND DeletedAt IS NULL AND DeletedBy IS NULL)                
     BEGIN              
         SELECT CAST(0 AS INT) as KeyValue,               
         'Phone Number already exists.' as ErrorMessage;              
     END  
     ELSE  
     BEGIN                         
    UPDATE [dbo].[Phones] SET        
    PhoneNumber=@PhoneNumber,        
    PhoneCode=@PhoneCode,        
    UpdatedBy = @UpdatedBy,              
    UpdatedAt = GETDATE()              
    WHERE PhoneId = @PhoneId      
              
     SELECT @PhoneId as KeyValue,                       
     'Phone number updated' as ErrorMessage               
END              
END              
END TRY                          
BEGIN CATCH                        
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                        
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                        
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                        
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                        
END CATCH                   
              
              
END 
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomerApproveStatus]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
           
CREATE PROCEDURE [dbo].[UpdateCustomerApproveStatus]            
@CustomerId INT,                 
@ApprovedBy SMALLINT            
AS            
BEGIN            
 SET NOCOUNT ON;            
BEGIN TRY                      
IF NOT EXISTS (SELECT CustomerId FROM [dbo].[Customers] WHERE CustomerId = @CustomerId)            
BEGIN            
  SELECT @CustomerId as KeyValue,                     
  'NO RECORD FOUND' as ErrorMessage            
END            
ELSE            
BEGIN            
            
 UPDATE [dbo].[Customers] SET    
    StatusId=3,         
    ApprovedBy = @ApprovedBy,            
    ApprovedAt = GETDATE()            
 WHERE CustomerId = @CustomerId    
            
   SELECT @CustomerId as KeyValue,                     
   'Customers Approved successfully' as ErrorMessage   
  
    IF @CustomerId > 0          
    BEGIN          
      
        UPDATE [dbo].[L_CustomerAddresses] SET  
        StatusId=3,  
        ApprovedBy = @ApprovedBy,            
        ApprovedAt = GETDATE()  
          
        UPDATE [dbo].[L_CustomerContacts] SET  
        StatusId=3,  
        ApprovedBy = @ApprovedBy,            
        ApprovedAt = GETDATE()
        
        UPDATE [dbo].[CustomerDocuments]SET  
        StatusId=3,  
        ApprovedBy = @ApprovedBy,            
        ApprovedAt = GETDATE()   
       
   END             
END            
            
END TRY                        
BEGIN CATCH                      
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                      
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                      
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                      
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                      
END CATCH                 
            
            
END   
  
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomerInActiveStatus]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
   
--UpdateCustomerInActiveStatus 84,1,'testing',76         
CREATE PROCEDURE [dbo].[UpdateCustomerInActiveStatus]                
@CustomerId INT,                     
@StatusId SMALLINT,    
@InActiveReason NVARCHAR(1000),    
@UpdatedBy SMALLINT               
AS                
BEGIN                
 SET NOCOUNT ON;                
BEGIN TRY                          
    IF NOT EXISTS (SELECT CustomerId FROM [dbo].[Customers] WHERE CustomerId = @CustomerId)                
        BEGIN                
            SELECT @CustomerId as KeyValue,                         
            'NO RECORD FOUND' as ErrorMessage                
        END                
    ELSE                
        BEGIN             
             UPDATE [dbo].[Customers] SET        
                StatusId=@StatusId,             
                UpdatedBy = @UpdatedBy,                
                UpdatedAt = GETDATE()                
             WHERE CustomerId = @CustomerId      
                
             SELECT @CustomerId as KeyValue,                         
             'Customers update successfully' as ErrorMessage       
      
               IF @CustomerId > 0              
               BEGIN  
                    UPDATE [dbo].[L_CustomerInActiveReasons] SET  
                    DeletedAt =GETDATE(),  
                    DeletedBy= @UpdatedBy where CustomerId=@CustomerId  

                    INSERT INTO [dbo].[L_CustomerInActiveReasons](InActiveReason,StatusId,CustomerId)    
                    VALUES (@InActiveReason,@StatusId,@CustomerId)  
                    UPDATE [dbo].[L_CustomerAddresses] SET  StatusId=@StatusId where CustomerId=@CustomerId    
                    UPDATE [dbo].[L_CustomerContacts] SET  StatusId=@StatusId where CustomerId=@CustomerId    
                    UPDATE [dbo].[CustomerDocuments] SET  StatusId=@StatusId where CustomerId=@CustomerId     
               END    
                     
                          
    END              
                
END TRY                            
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                     
                
                
END 
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomerNotes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE  [dbo].[UpdateCustomerNotes] 
	@CustomerNoteId bigint,
	 @CustomerId int,	
	@Note nvarchar(1000),
	@UpdatedBy smallint
AS
BEGIN      
	SET NOCOUNT ON;      
	BEGIN TRY                
		IF NOT EXISTS (SELECT CustomerId FROM [dbo].[CustomerNotes] WHERE CustomerId = @CustomerId)      
			BEGIN      
			  SELECT @CustomerNoteId as KeyValue,               
			  'NO RECORD FOUND' as ErrorMessage      
			END      
		ELSE      
			BEGIN      
      
			 UPDATE [dbo].[CustomerNotes] SET
				CustomerId=@CustomerId,
				Note=@Note,
				UpdatedBy = @UpdatedBy,      
				UpdatedAt = GETDATE()      
			 WHERE CustomerNoteId = @CustomerNoteId   
      
			 SELECT @CustomerNoteId as KeyValue,               
			 'Notes Updated' as ErrorMessage       
			END      
      
	END TRY                  
	BEGIN CATCH                
	 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
	 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                
	 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                
		RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
	END CATCH           
  
END
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomersBasicInformation]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UpdateCustomersBasicInformation]                
@CustomerId INT,      
@Name VARCHAR(200),          
@GroupTypeId SMALLINT,          
@TerritoryId VARCHAR(150),          
@CountryId SMALLINT,          
@EmailAddress VARCHAR(255),          
@Website NVARCHAR(250),                   
@Note VARCHAR(200),          
@IsCompany BIT,          
@TaxId VARCHAR(15),        
@UpdatedBy SMALLINT,
@IsBuyingForThirdParty bit,
@ResponsibleUserId SMALLINT
AS                
BEGIN                
 SET NOCOUNT ON;                
 BEGIN TRY                          
 -- Check if customer exists      
    IF NOT EXISTS (SELECT 1 FROM [dbo].[Customers] WHERE CustomerId = @CustomerId)                
    BEGIN                
        SELECT @CustomerId AS KeyValue,                         
        'NO RECORD FOUND' AS ErrorMessage;      
    END                
          
    ELSE    
    BEGIN    
   -- Update customer information      
   UPDATE [dbo].[Customers]      
   SET         
    Name = @Name,      
    GroupTypeId = @GroupTypeId,      
    TerritoryId = @TerritoryId,      
    CountryId = @CountryId,      
    Website = @Website,       
    IsCompany = @IsCompany,         
    TaxId = @TaxId,        
    UpdatedBy = @UpdatedBy,      
    UpdatedAt = GETDATE(),
	IsBuyingForThirdParty = @IsBuyingForThirdParty,
	ResponsibleUserId = @ResponsibleUserId
   WHERE CustomerId = @CustomerId;       
              
   -- Update or Insert Email      
   IF EXISTS (SELECT 1 FROM [dbo].[Emails] WHERE OwnerId = @CustomerId AND OwnerTypeId =1)      
   BEGIN      
    UPDATE [dbo].[Emails]      
    SET EmailAddress = @EmailAddress,      
     UpdatedBy = @UpdatedBy,      
     UpdatedAt = GETDATE()      
    WHERE OwnerId = @CustomerId AND OwnerTypeId = 1;      
   END      
       
      
   -- Update or Insert Note      
   IF EXISTS (SELECT 1 FROM [dbo].[CustomerNotes] WHERE CustomerId = @CustomerId)      
   BEGIN      
    UPDATE [dbo].[CustomerNotes]      
    SET Note = @Note,      
     UpdatedBy = @UpdatedBy,      
     UpdatedAt = GETDATE()      
    WHERE CustomerId = @CustomerId;      
   END      
             
   SELECT @CustomerId AS KeyValue,                         
   'Customer Information Updated' AS ErrorMessage;    
   END    
                
 END TRY                            
 BEGIN CATCH                          
 DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE();                          
 DECLARE @ErrorSeverity INT = ERROR_SEVERITY();                          
 DECLARE @ErrorState INT = ERROR_STATE();                          
 RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);                          
 END CATCH;                     
END; 
GO
/****** Object:  StoredProcedure [dbo].[UpdateCustomerStatus]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
          
CREATE PROCEDURE [dbo].[UpdateCustomerStatus]              
@CustomerId INT,                   
@StatusId SMALLINT,  
@UpdatedBy SMALLINT             
AS              
BEGIN              
 SET NOCOUNT ON;              
BEGIN TRY                        
    IF NOT EXISTS (SELECT CustomerId FROM [dbo].[Customers] WHERE CustomerId = @CustomerId)              
        BEGIN              
            SELECT @CustomerId as KeyValue,                       
            'NO RECORD FOUND' as ErrorMessage              
        END              
    ELSE              
        BEGIN              
             UPDATE [dbo].[Customers] SET      
                StatusId=@StatusId,           
                UpdatedBy = @UpdatedBy,              
                UpdatedAt = GETDATE(),  
                ApprovedBy=@UpdatedBy,  
                ApprovedAt =GETDATE()            
             WHERE CustomerId = @CustomerId   
     
             UPDATE [dbo].[L_CustomerAddresses] SET  StatusId=@StatusId where CustomerId=@CustomerId  
             UPDATE [dbo].[L_CustomerContacts] SET  StatusId=@StatusId where CustomerId=@CustomerId
             UPDATE [dbo].[CustomerDocuments] SET  StatusId=@StatusId where CustomerId=@CustomerId    
               
             SELECT @CustomerId as KeyValue,                       
             'Customers update successfully' as ErrorMessage     
        END            
             
END TRY                          
    BEGIN CATCH                        
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                        
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                        
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                        
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                        
    END CATCH                   
END    

GO
/****** Object:  StoredProcedure [dbo].[UpdateDeliveryMethods]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UpdateDeliveryMethods]                  
@CustomerDeliveryMethodId INT,          
@CustomerId INT,          
@DeliveryMethodId TINYINT,          
@Charge DECIMAL(5,2),          
@IsPrimary BIT,                 
@UpdatedBy SMALLINT                  
AS                  
BEGIN                  
SET NOCOUNT ON;                  
BEGIN TRY          
    IF @IsPrimary =1          
    BEGIN          
        UPDATE [dbo].[L_CustomCharge_CustomerDeliveryMethods] SET          
        IsPrimary=0          
        WHERE CustomerId =@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL          
    END
              
    UPDATE [dbo].[L_CustomCharge_CustomerDeliveryMethods] SET            
        [Charge]=@Charge,          
        [IsPrimary]=@IsPrimary,                  
        UpdatedBy = @UpdatedBy,                  
        UpdatedAt = GETDATE()                  
    WHERE CustomerDeliveryMethodId = @CustomerDeliveryMethodId AND CustomerId =@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL                
 
   SELECT @CustomerDeliveryMethodId as KeyValue,                           
    'Customer delivery method updated' as ErrorMessage
 
   IF NOT EXISTS (SELECT 1 FROM [dbo].[L_CustomCharge_CustomerDeliveryMethods] where DeliveryMethodId=@DeliveryMethodId AND CustomerId = @CustomerId)        
    BEGIN     
        UPDATE [dbo].[L_CustomCharge_CustomerDeliveryMethods] SET            
        [DeliveryMethodId]=@DeliveryMethodId,            
        UpdatedBy = @UpdatedBy,                  
        UpdatedAt = GETDATE()                  
    WHERE CustomerDeliveryMethodId = @CustomerDeliveryMethodId AND CustomerId =@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL                 
    END        
    ELSE        
    BEGIN        
         SELECT CAST(0 AS INT) as KeyValue,             
         'Delivery Method  already EXISTS' as ErrorMessage;          
    END            
END TRY                              
BEGIN CATCH                            
DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                            
DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                            
DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                            
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                            
END CATCH                       

END
GO
/****** Object:  StoredProcedure [dbo].[UpdateRoles]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
       
CREATE PROCEDURE [dbo].[UpdateRoles]        
@RoleId TINYINT,  
@RoleName VARCHAR(50),            
@UpdatedBy SMALLINT        
AS        
BEGIN        
 SET NOCOUNT ON;        
BEGIN TRY                  
IF NOT EXISTS (SELECT RoleId FROM [dbo].[Roles] WHERE RoleId = @RoleId)        
BEGIN        
  SELECT @RoleId as KeyValue,                 
  'NO RECORD FOUND' as ErrorMessage        
END        
ELSE        
BEGIN        
        
 UPDATE [dbo].[Roles] SET  
    RoleName=@RoleName,  
    UpdatedBy = @UpdatedBy,        
    UpdatedAt = GETDATE()        
 WHERE RoleId = @RoleId
        
 SELECT @RoleId as KeyValue,                 
 'Role Updated' as ErrorMessage         
END        
        
END TRY                    
BEGIN CATCH                  
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                  
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                  
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                  
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                  
END CATCH             
        
        
END 
GO
/****** Object:  StoredProcedure [dbo].[UpdateShppingDeliveryCarriers]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
               
CREATE PROCEDURE [dbo].[UpdateShppingDeliveryCarriers]                
@CustomerDeliveryCarrierId BIGINT,        
@CustomerId INT,        
@AccountNumber VARCHAR(50),       
@CarrierId SMALLINT,       
@IsPrimary BIT,               
@UpdatedBy SMALLINT                
AS                
BEGIN                
 SET NOCOUNT ON;                
BEGIN TRY        
        
        IF @IsPrimary =1        
        BEGIN        
            UPDATE [dbo].[L_CustomerDeliveryCarriers] SET        
            IsPrimary=0        
            WHERE CustomerId =@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL        
        END        
        
        UPDATE [dbo].[L_CustomerDeliveryCarriers] SET          
            AccountNumber=@AccountNumber,      
            IsPrimary=@IsPrimary,                
            UpdatedBy = @UpdatedBy,                
            UpdatedAt = GETDATE()                
        WHERE CustomerDeliveryCarrierId = @CustomerDeliveryCarrierId AND CustomerId =@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL              
                
        SELECT @CustomerDeliveryCarrierId as KeyValue,                         
        'Customer delivery carriers updated' as ErrorMessage   
          
        IF NOT EXISTS (SELECT 1 FROM [dbo].[L_CustomerDeliveryCarriers] where CarrierId=@CarrierId AND CustomerId = @CustomerId)    
        BEGIN   
            UPDATE [dbo].[L_CustomerDeliveryCarriers] SET              
                CarrierId=@CarrierId,                  
                UpdatedBy = @UpdatedBy,                
                UpdatedAt = GETDATE()                
            WHERE CustomerDeliveryCarrierId = @CustomerDeliveryCarrierId AND CustomerId =@CustomerId AND DeletedAt IS NULL AND DeletedBy IS NULL     
        END        
        ELSE    
        BEGIN    
            SELECT CAST(0 AS INT) as KeyValue,         
            'Delivery carriers already exists.' as ErrorMessage;      
        END            
END TRY                            
BEGIN CATCH                          
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
END CATCH                     
                
                
END 
GO
/****** Object:  StoredProcedure [dbo].[UpdateSupplierApproveStatus]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
           
CREATE PROCEDURE [dbo].[UpdateSupplierApproveStatus]            
@SupplierId INT,                 
@ApprovedBy SMALLINT            
AS            
BEGIN            
 SET NOCOUNT ON;            
BEGIN TRY                      
        IF NOT EXISTS (SELECT [SupplierId] FROM [dbo].[Suppliers] WHERE SupplierId = @SupplierId AND DeletedAt IS NULL AND DeletedBy IS NULL)            
        BEGIN            
          SELECT @SupplierId as KeyValue,                     
          'NO RECORD FOUND' as ErrorMessage            
        END            
        ELSE            
        BEGIN            
            
         UPDATE [dbo].[Suppliers]SET    
            StatusId=3--,         
            --ApprovedBy = @ApprovedBy,            
            --ApprovedAt = GETDATE()            
         WHERE SupplierId = @SupplierId    
            
       SELECT @SupplierId as KeyValue,                     
       'Supplier Approved successfully' as ErrorMessage   
  
        IF @SupplierId > 0          
        BEGIN          
      
            UPDATE [dbo].[L_SupplierAddresses] SET  
            StatusId=3,  
            ApprovedBy = @ApprovedBy,            
            ApprovedAt = GETDATE()  
          
            UPDATE [dbo].[L_SupplierContacts]SET  
            StatusId=3,  
            ApprovedBy = @ApprovedBy,            
            ApprovedAt = GETDATE()
        
            UPDATE [dbo].[SupplierDocuments] SET  
            StatusId=3,  
            ApprovedBy = @ApprovedBy,            
            ApprovedAt = GETDATE()   
       END             
END            
            
END TRY                        
BEGIN CATCH                      
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                      
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                      
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                      
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                      
END CATCH                 
            
            
END   
  
GO
/****** Object:  StoredProcedure [dbo].[UpdateSupplierInActiveStatus]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
          
CREATE PROCEDURE [dbo].[UpdateSupplierInActiveStatus]              
@SupplierId INT,                   
@StatusId SMALLINT,  
@InActiveReason NVARCHAR(1000),  
@UpdatedBy SMALLINT             
AS              
BEGIN              
 SET NOCOUNT ON;              
BEGIN TRY                        
    IF NOT EXISTS (SELECT SupplierId FROM [dbo].[Suppliers] WHERE SupplierId = @SupplierId AND DeletedAt IS NULL AND DeletedBy IS NULL)              
        BEGIN              
            SELECT @SupplierId as KeyValue,                       
            'NO RECORD FOUND' as ErrorMessage              
        END              
       ELSE              
        BEGIN              
                UPDATE [dbo].[Suppliers] SET      
                StatusId=@StatusId,           
                UpdatedBy = @UpdatedBy,              
                UpdatedAt = GETDATE()              
                WHERE SupplierId = @SupplierId      
              
                SELECT @SupplierId as KeyValue,                       
                'Supplier update successfully' as ErrorMessage     
    
            IF @SupplierId > 0            
            BEGIN   
                UPDATE [dbo].[L_SupplierInActiveReasons] SET  
                DeletedBy = @UpdatedBy,  
                DeletedAt = GETDATE()  
                WHERE SupplierId = @SupplierId    
           
                INSERT INTO [dbo].[L_SupplierInActiveReasons](InActiveReason,StatusId,SupplierId)  
                VALUES (@InActiveReason,@StatusId,@SupplierId)  

                UPDATE [dbo].[L_SupplierAddresses]SET  StatusId=@StatusId  WHERE SupplierId = @SupplierId  
                UPDATE [dbo].[L_SupplierContacts] SET  StatusId=@StatusId WHERE SupplierId = @SupplierId  
                UPDATE [dbo].[SupplierDocuments]SET  StatusId=@StatusId  WHERE SupplierId = @SupplierId     
         END               
    END            
              
END TRY                          
BEGIN CATCH                        
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                        
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                        
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                        
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                        
END CATCH                   
              
              
END     
GO
/****** Object:  StoredProcedure [dbo].[UpdateSupplierNotes]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[UpdateSupplierNotes] 

	@SupplierNoteId bigint,
	 @SupplierId int,	
	@Note nvarchar(1000),
	@UpdatedBy smallint
AS
BEGIN
	
	SET NOCOUNT ON;
	BEGIN TRY                
		IF NOT EXISTS (SELECT SupplierId FROM [dbo].[SupplierNotes] WHERE SupplierId = @SupplierId)      
			BEGIN      
			  SELECT @SupplierNoteId as KeyValue,               
			  'NO RECORD FOUND' as ErrorMessage      
			END      
		ELSE      
			BEGIN      
      
			 UPDATE [dbo].[SupplierNotes] SET
				SupplierId = @SupplierId,
				Note=@Note,
				UpdatedBy = @UpdatedBy,      
				UpdatedAt = GETDATE()      
			 WHERE SupplierNoteId = @SupplierNoteId
      
			 SELECT @SupplierNoteId as KeyValue,               
			 'Notes Updated' as ErrorMessage       
			END      
      
	END TRY                  
	BEGIN CATCH                
	 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
	 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                
	 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                
		RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
	END CATCH     
  
END

GO
/****** Object:  StoredProcedure [dbo].[UpdateSupplierStatus]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
            
CREATE PROCEDURE [dbo].[UpdateSupplierStatus]                
@SupplierId INT,                     
@StatusId SMALLINT,    
@UpdatedBy SMALLINT               
AS                
BEGIN                
 SET NOCOUNT ON;                
BEGIN TRY                          
    IF NOT EXISTS (SELECT SupplierId FROM [dbo].[Suppliers] WHERE SupplierId = @SupplierId)                
        BEGIN                
            SELECT @SupplierId as KeyValue,                         
            'NO RECORD FOUND' as ErrorMessage                
        END                
    ELSE                
        BEGIN                
             UPDATE [dbo].[Suppliers] SET        
                StatusId=@StatusId,             
                UpdatedBy = @UpdatedBy,                
                UpdatedAt = GETDATE()    
                --ApprovedBy=@UpdatedBy,    
                --ApprovedAt =GETDATE()              
             WHERE SupplierId = @SupplierId     
       
             UPDATE [dbo].[L_SupplierAddresses] SET  StatusId=@StatusId where SupplierId =@SupplierId    
             UPDATE [dbo].[L_SupplierContacts] SET  StatusId=@StatusId where SupplierId=@SupplierId  
             UPDATE [dbo].[SupplierDocuments] SET  StatusId=@StatusId where SupplierId=@SupplierId      
                 
             SELECT @SupplierId as KeyValue,                         
             'Supplier update successfully' as ErrorMessage       
        END              
               
END TRY                            
    BEGIN CATCH                          
     DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                          
     DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                          
     DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                          
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                          
    END CATCH                     
END      
  
GO
/****** Object:  StoredProcedure [dbo].[UpdateUser]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
     
CREATE PROCEDURE [dbo].[UpdateUser]      
@UserId SMALLINT,
@FirstName VARCHAR(200),  
@LastName VARCHAR(200),  
@UserName VARCHAR(200),    
@IsActive bit,       
@UpdatedBy SMALLINT      
AS      
BEGIN      
 SET NOCOUNT ON;      
BEGIN TRY                
IF NOT EXISTS (SELECT UserId FROM [dbo].[Users] WHERE UserId = @UserId)      
BEGIN      
  SELECT @UserID as KeyValue,               
  'NO RECORD FOUND' as ErrorMessage      
END      
ELSE      
BEGIN      
      
 UPDATE [dbo].[Users] SET
    FirstName=@FirstName,
	LastName=@LastName,
    UserName=@UserName,      
    IsActive=@IsActive,      
    UpdatedBy = @UpdatedBy,      
    UpdatedAt = GETDATE()      
 WHERE UserId = @UserId    
      
 SELECT @UserID as KeyValue,               
 'User Updated' as ErrorMessage       
END      
      
END TRY                  
BEGIN CATCH                
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()                
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
END CATCH           
      
      
END 
GO
/****** Object:  StoredProcedure [dbo].[UpdateUserPassword]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
    
      
CREATE PROCEDURE  [dbo].[UpdateUserPassword]            
  @UserId smallint,            
  @HashedPassword nvarchar(64),          
  @PasswordSalt nvarchar(32),           
  @UpdatedBy smallint            
    
AS        
BEGIN        
 -- SET NOCOUNT ON added to prevent extra result sets from        
 -- interfering with SELECT statements.        
  
 SET NOCOUNT ON;        
BEGIN TRY         
        
 UPDATE Users            
 SET             
   [HashedPassword] = @HashedPassword,            
   [PasswordSalt] = @PasswordSalt,            
   [Updatedat] = GETUTCDATE(),            
   [UpdatedBy] = @UpdatedBy       
  WHERE UserId = @UserId AND [DeletedBy] is null AND [DeletedAt] is null        
    
  SELECT @UserID as KeyValue,             
  'Password Updated' as ErrorMessage           
            
END TRY                
BEGIN CATCH              
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()              
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()              
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()              
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)              
END CATCH              
END     
GO
/****** Object:  StoredProcedure [dbo].[ValidateCustomerData]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ValidateCustomerData 6    
CREATE PROCEDURE [dbo].[ValidateCustomerData]    
 @CustomerId INT    
AS    
BEGIN    
    DECLARE @ValidationResults TABLE    
    (    
        IsValid BIT,    
        Messages NVARCHAR(MAX)    
    );    
    
    DECLARE @IsValid BIT = 1; 
	DECLARE @CustomerName NVARCHAR(100)
	SELECT @CustomerName = Name FROM Customers WHERE CustomerId = @CustomerId
    
    -- Check For Customer Basic Destils    
    IF EXISTS (SELECT 1 FROM Customers WHERE CustomerId = @CustomerId AND TaxId IS NOT NULL)    
    BEGIN    
        INSERT INTO @ValidationResults (IsValid, Messages)    
        VALUES (1, @CustomerName + ' has an TaxId');    
    END    
    ELSE    
    BEGIN    
        SET @IsValid = 0;    
        INSERT INTO @ValidationResults (IsValid, Messages)    
        VALUES (0,  @CustomerName +' does not have an TaxId');    
    END    
    
    -- Check For Customer Address    
    IF EXISTS (SELECT 1 FROM L_CustomerAddresses WHERE CustomerId = @CustomerId AND AddressId IS NOT NULL)    
    BEGIN    
        INSERT INTO @ValidationResults (IsValid, Messages)    
        VALUES (1, @CustomerName +' has an Address');    
    END    
    ELSE    
    BEGIN    
        SET @IsValid = 0;    
        INSERT INTO @ValidationResults (IsValid, Messages)    
        VALUES (0, @CustomerName +' does not have an Address');    
    END    
    
    -- Check For Customer Contact    
    IF EXISTS (SELECT 1 FROM L_CustomerContacts WHERE CustomerId = @CustomerId AND ContactId IS NOT NULL)    
    BEGIN    
        INSERT INTO @ValidationResults (IsValid, Messages)    
        VALUES (1, @CustomerName +' has a Contact');    
    END    
    ELSE    
    BEGIN    
        SET @IsValid = 0;    
        INSERT INTO @ValidationResults (IsValid, Messages)    
        VALUES (0, @CustomerName +' does not have a Contact');    
    END 
    -- Return the list of validation results    
    SELECT IsValid, Messages    
    FROM @ValidationResults;    
END 
GO
/****** Object:  StoredProcedure [dbo].[ValidateSupplierData]    Script Date: 28-06-2024 19:19:45 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ValidateSupplierData 6  
CREATE PROCEDURE [dbo].[ValidateSupplierData]  
 @SupplierId INT  
AS  
BEGIN  
    DECLARE @ValidationResults TABLE  
    (  
        IsValid BIT,  
        Messages NVARCHAR(MAX)  
    );  
  
    DECLARE @IsValid BIT = 1;   
  
    -- Check For Customer Basic Destils  
    IF EXISTS (SELECT 1 FROM Suppliers WHERE SupplierId = @SupplierId  AND TaxId IS NOT NULL)  
    BEGIN  
        INSERT INTO @ValidationResults (IsValid, Messages)  
        VALUES (1, 'Supplier has an TaxId');  
    END  
    ELSE  
    BEGIN  
        SET @IsValid = 0;  
        INSERT INTO @ValidationResults (IsValid, Messages)  
        VALUES (0, 'Supplier does not have an TaxId');  
    END  
  
    -- Check For Customer Address  
    IF EXISTS (SELECT 1 FROM L_SupplierAddresses WHERE SupplierId = @SupplierId AND AddressId IS NOT NULL)  
    BEGIN  
        INSERT INTO @ValidationResults (IsValid, Messages)  
        VALUES (1, 'Supplier has an Address');  
    END  
    ELSE  
    BEGIN  
        SET @IsValid = 0;  
        INSERT INTO @ValidationResults (IsValid, Messages)  
        VALUES (0, 'Supplier does not have an Address');  
    END  
  
    -- Check For Customer Contact  
    IF EXISTS (SELECT 1 FROM L_SupplierContacts WHERE SupplierId = SupplierId AND ContactId IS NOT NULL)  
    BEGIN  
        INSERT INTO @ValidationResults (IsValid, Messages)  
        VALUES (1, 'Supplier has a Contact');  
    END  
    ELSE  
    BEGIN  
        SET @IsValid = 0;  
        INSERT INTO @ValidationResults (IsValid, Messages)  
        VALUES (0, 'Supplier does not have a Contact');  
    END  
  
    -- Return the list of validation results  
    SELECT IsValid, Messages  
    FROM @ValidationResults;  
END  
GO
